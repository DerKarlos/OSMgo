import{O as Va,G as ln,P as St,M as V,a as xe,B as Ae,b as es,c as _t,S as Ke,d as Oa,V as ee,E as fn,e as ut,D as Qe,f as Ha,C as la,L as dn,g as Ei,h as zn,T as Cn,m as $i,i as Ln,j as Pa,k as ks,l as Ss,n as Bt,o as Za,p as fa,R as In,F as _s,q as un,r as Rn,s as Xn,t as cn,u as Bn,v as pn,w as vn,x as Yn,Q as As,y as qn,W as Un,z as Gs,A as Ns,H as Vn,I as Hn,J as Zn,K as Qn,N as Jn,U as $n,X as jn}from"./three-DnKo-com.js";import{c as ur}from"./chroma-js-DUfPS_J0.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function e(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(a){if(a.ep)return;a.ep=!0;const s=e(a);fetch(a.href,s)}})();var yt=[],ts,gn=void 0;function is(t,i){if(i*1>yi)return!1;if(i=="yes")return!0;p("3D Model placing - addRepo id3d:"+i+" node.id:"+t.id),ts=be+"3dmr.eu/api/";var e=new Va;if(e.osm=t,t.mesh3D=e,yt[i]||new yn(t,i),yt[i].mesh){var r=yt[i].info;p("ttt Repo: info: "+r),e.add(yt[i].mesh.clone()),e.scale.set(r.scale,r.scale,r.scale),e.rotation.y+=k(-r.rotation),wi(e)}else yt[i].que.push(e);var a=t.GetTag("direction",0)*1;return p("ttt Repo: dir = "+a),e.rotation.y=k(-a),e.position.x=t.x,e.position.y=t.GetLLm(0),e.position.z=t.z,e.name="3dmr:"+i,t.osm=e,!0}function yn(t,i){return T>2&&p("Repo:"+i),this.node=t,this.id3d=i,this.o3d=new Va,this.mesh=void 0,this.que=[],this.info="",this.listRepo(),yt[i]=this,this}yn.prototype.listRepo=function(){T>2&&p("listRepo:"+this.id3d);var t=this.id3d,i=ts+"info/"+this.id3d,e=new XMLHttpRequest;e.onreadystatechange=function(){e.readyState==4&&e.status==200&&(T>2&&p("listRepo:"+e.response+"!"+t),yt[t].info=JSON.parse(e.response),Kn(t))},e.open("GET",i,!0),e.send()};function Kn(t){T>2&&p("loadRepo:"+t,"!"),T>2&&p("loadRepo mtl:"+model);var i=ts+"model/"+t;gn=t;var e=new ln;e.load(i,eo)}var eo=function(t){var i=t.scene.clone(),e=gn,r=yt[e].info;i.position.x+=r.translation[0],i.position.y+=r.translation[2],i.position.z+=r.translation[1];for(var a in yt[e].que){p("########### meshRepo id3d: "+e+" info.translation: "+r.translation+" info.rotation: "+r.rotation),T>2&&p("meshRepo instance:"+a);var s=yt[e].que[a];s.scale.set(r.scale,r.scale,r.scale),s.rotation.y+=k(-r.rotation),s.info=r,s.add(i.clone()),s.updateMatrixWorld(!0),wi(s)}},mt=[];function to(){mt=[]}var za,cr=0;function _e(t){if(t==13462323&&p("ttt rel id !!!"),mt[t]){this.id=0;return}this.id=t,this.tags=[],this.values=[],cr&&(cr.next=this),cr=this,za||(za=this),this.mmbrs=[],this.types=[],this.roles=[],this.typeMain=void 0,mt[t]=this,T>=4&&p("new Rel ",t)}_e.prototype.AddMember=function(t,i,e){{if(this.mmbrs===void 0){p("MIST!rm",this,t);return}this.mmbrs.push(t),this.types.push(i),this.roles.push(e)}};_e.prototype.AddTag=function(t,i){{if(!this.tags){p("tags MIST!rt",this.id,t,i,this),alert("Rel.prototype.AddTag "+this.id);return}this.tags.push(t),this.values.push(i)}};_e.prototype.GetTag=function(t){{for(var i in this.tags)if(this.tags[i]==t)return this.values[i];return!1}};_e.prototype.Visible=function(t){{for(var i in this.mmbrs)if(this.roles[i]=="part"){var e=ue[this.mmbrs[i]];if(!e)return!1;e.mesh&&(e.mesh.visible=t)}return!0}};_e.prototype.Type3d_model=function(){{if($("mdl",1)*1==0||this.model)return;this.model=this.GetTag("model");var t=this.GetTag("server"),i=this.GetTag("format");i||(i="obj");for(var e in this.mmbrs)switch(this.roles[e]){case"center":if(this.types[e]!="node")return;var r=H[this.mmbrs[e]];Di(this.id,t,this.model,r.x,r.z,i);break;case"hide":this.types[e]=="node"&&It.push(-this.mmbrs[e]),this.types[e]=="way"&&It.push(+this.mmbrs[e]),this.types[e]=="rel"&&It.push(+this.mmbrs[e]+1e10);break}}};_e.prototype.TypeLevel=function(){for(var t in this.mmbrs){var i=this.mmbrs[t],e=this.types[t];switch(this.roles[t]){case"shell":if(e=="way"){var r=mt[i];r&&r.Place(!0);continue}if(e=="relation"){var a=ue[i];a&&a.Place();continue}T>2&&p("level shell type!=way",this.id,t,this.roles[t]);continue;case"buildingpart":continue}}};_e.prototype.TypeShell=function(){};_e.prototype.TypeMultipolygon=function(t){{t||(t=!1),this.GetTag("3dmr")&&p("3dmr-Relation: Multipolygon not coded!!!!!"),this.holes=[],this.outer=[],this.nodes=[],this.parts=0;for(var i in this.mmbrs){if(this.types[i]!="way"){T>2&&at("Multipolygon mmbr != way! "+this.id+" "+i);return}var e=ue[this.mmbrs[i]];if(e)switch(this.roles[i]){case"inner":var r=e.Shape();this.holes.length<111&&r&&this.holes.push(r);break;case"outer":if(t){e.typeMain="R"+this.id;continue}this.outer.push(e);var a=e.wayNodes[0],s=e.wayNodes[e.wayNodes.length-1];if(a!=s){T==9&&p("multipolligone: "+a+"-"+s+"-"+this.nodes[0]);var n=0;if(this.nodes.length==0){this.nodes=e.wayNodes,this.parts=1;continue}if(this.nodes[this.nodes.length-1]==a)this.nodes.pop(),this.nodes=this.nodes.concat(e.wayNodes),n=1;else if(this.nodes[this.nodes.length-1]==s)this.nodes.pop(),this.nodes=this.nodes.concat(e.wayNodes.reverse()),n=1;else if(s==this.nodes[0])e.wayNodes.pop(),this.nodes=e.wayNodes.concat(this.nodes),n=1;else if(a==this.nodes[0]){var h=e.wayNodes.reverse();h.pop(),this.nodes=h.concat(this.nodes),n=1}n?this.parts++:this.parts=-9990909}else this.parts=-9990909;break}}if(this.outer.length==0){T>2&&at("Multipolygon with no outer!",this.id);return}if(this.parts>1){var e=new B(0),l=e.wayNodes,f=e.tags,d=e.values,u=e.id;e.wayNodes=this.nodes,e.tags=this.tags,e.values=this.values,e.typeMain="multipoligon",e.id=this.id;var v;(v=this.GetTag("building"))&&e.building(v),(v=this.GetTag("building:part"))&&(e.building(v),e.typeMain=void 0,e.tags=f,e.valuess=d,e.nodes=l,e.id=u),(v=this.GetTag("landuse"))&&e.landuse(v);return}for(var y in this.outer){var e=this.outer[y];e&&e.wayNodes[0]==e.wayNodes[e.wayNodes.length-1]&&(this.holes.length>0&&(e.holes=this.holes),this.tags.length>1&&(e.tags.length>0||(e.tags=this.tags,e.values=this.values)))}e.GetTag("area")||e.AddTag("area","yes"),this.GetTag("building")&&(e.building("yes"),e.typeMain="MuPo"+this.id),this.GetTag("building:part")&&(e.building("yes"),e.typeMain=void 0,e.tags=[])}};_e.prototype.TypeBuilding=function(){{var t;if((t=this.GetTag("3dmr"))&&p("3dmr-Relation: not coded!!!!!"),fi<1)return;for(var i in this.mmbrs){if(i.id*1==Gt)p("Debug Way Place, ID: ",i.id,this);else if(Ut)return;var e=this.roles[i];if(e!="inner"&&e!="part"){if(e.substring(0,3)=="als "&&alert("'als ' in"+r.id),e!="outer"&&e!="outline"){if(this.types[i]!="relation"){T>2&&p("building xxx type not rel",this.id,i,this.types[i]);continue}var r=mt[i];r&&r.Place(fi>=0);continue}var a=this.types[i];switch(a){case"way":var s=ue[this.mmbrs[i]];if(!s){T>2&&at("Multipolygon with MISSIG outer way !"+this.id+" "+i+" "+this.types[i]);continue}if(!s.GetTag("building:part")){T!=25&&(s.typeMain="R"+this.id);var t;if(t=s.GetTag("3dmr")){p("3dmr-Relation-OUTER");var n,h=0,l=0;for(var f in s.wayNodes){var d=H[s.wayNodes[f]];if(f==0){var n=new N(0,11,22);n.tileX=d.tileX,n.tileZ=d.tileZ,n.tags=s.tags,n.values=s.values;continue}h+=d.x,l+=d.z}if(h/=s.wayNodes.length-1,l/=s.wayNodes.length-1,n.x=h,n.z=l,n.typeMain="3dmr!",is(n,t))return}}break;case"relation":var u=this.mmbrs[i];if(!mt[u]){T>2&&at("rel member rel missing",this.id,i,u);break}var r=mt[u];if(r.type!="multipolygon"){T>2&&p("rel building relation not multipolygon");continue}r.Place(fi>=0);break}}}}};_e.prototype.Place=function(t){{if(t||(t=!1),this.typeMain)return;if(this.id*1==Gt)p("Debug Relation Place, ID: ",this.id,this);else if(Ut)return;switch(os(hs(this)),this.typeMain=this.GetTag("type"),this.typeMain){case"3d_model":this.Type3d_model();break;case"multipolygon":this.TypeMultipolygon(t);break;case"building":this.TypeBuilding();break}this.id*1==Gt&&Qo(2)}};var vt=[[]],J=[[]];function io(){J=[[]],vt=[[]]}function qr(t,i){return Math.floor((t+180)/360*Math.pow(2,i))}function Ur(t,i){return Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,i))}function Si(t,i){return t/Math.pow(2,i)*360-180}function _i(t,i){var e=Math.PI-2*Math.PI*t/Math.pow(2,i);return 180/Math.PI*Math.atan(.5*(Math.exp(e)-Math.exp(-e)))}var We=!1;function wn(t){We=t}var Os=$("more",1)*1,wt=0;typeof WebAssembly<"u"&&Le("wa")*1&&(wt=1);var ci=111100,Ca=ci,Oi=51.50706135,as=-.12781402,bi=0,Fs="---",ji,Ki,ea,ta,Vr=void 0,Hr,et;function tt(t,i){Ca=ci*Math.cos(Math.abs(i/180*Math.PI));var e=(t-as)*Ca;return Math.floor(e*100)/100}function it(t){var i=(Oi-t)*ci;return Math.floor(i*100)/100}es.prototype.Lon=function(){var t=-this.position.z/ci+Oi;return Ca=ci*Math.cos(Math.abs(t/180*Math.PI)),+this.position.x/Ca+as};es.prototype.Lat=function(){return-this.position.z/ci+Oi};function Es(){p("Tile load Timeout!"+new Date().toLocaleTimeString()),We.state=1,We=!1,ft.LoadOsmTiles()}var Ct=0,xi=[];function ao(t,i){if(i)var e=H[i];else var e=t.osm;if(!e){alert("add2Tile");return}if(e.tileY<ji&&(e.tileY=ji),e.tileX<Ki&&(e.tileX=Ki),e.tileY>ea&&(e.tileY=ea),e.tileX>ta&&(e.tileX=ta),!J[e.tileY]){re.add(t);return}if(!J[e.tileY][e.tileX]){re.add(t);return}var r=J[e.tileY][e.tileX].map;t.osm.GetTag("room")?r.more.add(t):r.add(t)}function Ds(t,i,e){if(e)var r=H[e];else var r=t.osm;if(!r){alert("add2TileG üüü3");return}if(t.osm.id*1==Gt)p("osm Building:",t.osm.id);else if(Ut)return;r.tileY<ji&&(r.tileY=ji),r.tileX<Ki&&(r.tileX=Ki),r.tileY>ea&&(r.tileY=ea),r.tileX>ta&&(r.tileX=ta);var a=J[r.tileY][r.tileX];J[r.tileY][r.tileX].map,t.computeBoundingSphere(),new xe,t.index&&(t=t.toNonIndexed()),rs(t,i),a.map_Geos.push(t)}function rs(t,i){var e=t.attributes.position.count,r=new Float32Array(e*3);if(t.groups.length)for(var a in t.groups){var s=t.groups[a].materialIndex,n=t.groups[a].start,e=t.groups[a].count;Ws(r,s,n,e)}else Ws(r,i,0,e);t.setAttribute("color",new Ae(r,3))}function Ws(t,i,e,r){for(var a=D[i],s=a.color,n=e;n<e+r;n++)t[n*3+0]=s.r,t[n*3+1]=s.g,t[n*3+2]=s.b}function pi(t,i){if(!t.osm){p("add_Map NO!!! ID:",t.osm.id);return}if(t.osm.id*1==Gt)p("mesh Object:",t.osm.id);else if(Ut)return;if(i)var e=H[i];else var e=t.osm;if(!e){alert("add_Map");return}if(!J[e.tileY]){re.add(t);return}if(!J[e.tileY][e.tileX]){re.add(t);return}var r=Math.abs(t.position.x-vi),a=Math.abs(t.position.z-gi),s=Wi(r,a),n=s<Ka,h=J[e.tileY][e.tileX];if(n||!t.material.iCol)h.map.add(t);else{var l=new xe().makeTranslation(t.position.x,t.position.y,t.position.z),f=t.geometry.clone();f.applyMatrix4(new xe().makeRotationY(t.rotation.y)),f.applyMatrix4(l),f.name=t.osm.id,f.index&&(f=f.toNonIndexed()),f.computeBoundingSphere();var d=t.material;typeof d==Array&&(p("array!".material.len),d=d[0]);var u=d.iCol;rs(f,u),h.map_Geos.push(f),os(0)}}function wi(t,i){var e;if(i?e=H[i]:e=t.osm,!J[e.tileY]){re.add(t);return}if(!J[e.tileY][e.tileX]){re.add(t);return}var r=Math.abs(t.position.x-vi),a=Math.abs(t.position.z-gi),n=Wi(r,a),s=n<Ka,n=e.GetTag("3dmr");if(Ci<2||s||e.GetTag("GO-Note")||n)n?J[e.tileY][e.tileX].map.add(t):J[e.tileY][e.tileX].map.more.add(t);else{var h=t.geometry;if(!h){p("addMore: no fgeo"),J[e.tileY][e.tileX].map.more.add(t);return}var l=J[e.tileY][e.tileX],f=new xe().makeTranslation(t.position.x,t.position.y,t.position.z);h.applyMatrix4(f),h.computeBoundingSphere();var d=t.material;Array.isArray(d)&&(d=d[0]);var u=d.iCol;rs(h,u),l.oth_Geos.push(h),os(0)}}function ro(t,i){var e=Math.pow(2,At),r=Math.floor(t/e),a=Math.floor(i/e);if(!(vt[r]&&vt[r][a]&&vt[r][a].state)){var s=new Object;s.state=1,s.lonIndex=a,s.latIndex=r,s.name="loadTile-"+a+"/"+r,vt[r]||(vt[r]=[]),vt[r][a]=s}}function La(t,i){if(!(J[t]&&J[t][i]&&J[t][i].state)){var e=new Object;e.state=1,e.lonIndex=i,e.latIndex=t,e.map=new V,e.map.more=new V,e.map.more.visible=!1,e.map.more.viewTile=!0,isNaN(i)&&alert("lonIndex NaN"),e.map.name="makeTile-"+i+"/"+t,e.map.add(e.map.more),re.add(e.map);var r=_i(t+1,pe),a=Si(i,pe),s=_i(t,pe),n=Si(i+1,pe);oh(tt(a,r),it(r),tt(n,r),it(s));var h=o.floor;fe>1&&(h=Ee);var l=new St(er-ha,zi-tr,1,1),f=new V(l,h);f.rotation.x=k(-90),f.position.x=ha+f.geometry.parameters.width/2,f.position.z=zi-f.geometry.parameters.height/2,f.position.y=-.05*9,f.name="viewTile"+t+"/"+i,f.receiveShadow=R,e.map.add(f),e.floor=f,e.map_Geos=[],e.oth_Geos=[],J[t]||(J[t]=[]),J[t][i]=e,ro(t,i),ft.LoadOsmTiles()}}function Qt(t,i,e){if(J[t]&&J[t][i]){var r=J[t][i];r.state==0&&e>0&&La(t,i),r.state==1&&e==0&&(r.map.visible=!1,r.state=0),r.state==3&&e==0&&(r.map.visible=!1,r.state=4),r.state==4&&e>0&&(r.map.visible=!0,r.state=3),r.map.more.visible=e==2,Ci>2&&(r.map.more.visible=!1);return}e&&La(t,i)}async function so(){console.log("++");var t={env:{new_Node:no,new_Way:oo,new_Rel:ho,addNodeTag:fo,addWayNode:lo,addWayTag:uo,addRelMem:po,addRelTag:co}};wt=2;const i=await fetch("tile.wasm");console.log("wasm11");const e=await i.arrayBuffer();console.log("wasm22");const r=await WebAssembly.compile(e);console.log("wasm33");const a=new WebAssembly.Instance(r,t);console.log("exports:",a.exports),Hr=a.exports,et=a.exports.memory,wt=3,console.log("--"),ft.LoadOsmTiles()}var Zr,ia,aa;function Qa(t){if(!(t<0)){var i=new Int8Array(et.buffer,t,33),e=new TextDecoder().decode(i);return e=e.split(",")[0],e=e.split(`
`)[0],e=e.split("\0")[0],e*1}}function no(t,i,e){var r=Qa(t);Zr=new N(r,i,e)}function oo(t){var i=Qa(t);ia=new B(i)}function ho(t){var i=Qa(t);aa=new _e(i)}function lo(t){var i=Qa(t);t==519653630&&console.log("wasm519653630"),ia.id&&ia.AddNode(i)}function fo(t,i){var e=new Int8Array(et.buffer,t,244),r=new Int8Array(et.buffer,i,244);e=new TextDecoder().decode(e),r=new TextDecoder().decode(r),e=e.split("\0")[0],r=r.split("\0")[0],Zr.id&&Zr.AddTag(e,r)}function uo(t,i){var e=new Int8Array(et.buffer,t,244),r=new Int8Array(et.buffer,i,244);e=new TextDecoder().decode(e),r=new TextDecoder().decode(r),e=e.split("\0")[0],r=r.split("\0")[0],ia.id&&ia.AddTag(e,r)}function co(t,i){var e=new Int8Array(et.buffer,t,244),r=new Int8Array(et.buffer,i,244);e=new TextDecoder().decode(e),r=new TextDecoder().decode(r),e=e.split("\0")[0],r=r.split("\0")[0],aa.id&&aa.AddTag(e,r)}function po(t,i,e){var r=new Int8Array(et.buffer,t,244),a=new Int8Array(et.buffer,i,244),s=new Int8Array(et.buffer,e,244);r=new TextDecoder().decode(r),a=new TextDecoder().decode(a),s=new TextDecoder().decode(s),r=r.split("\0")[0],a=a.split("\0")[0],s=s.split("\0")[0],aa.id&&aa.AddMember(a,r,s)}function vo(t){console.log(t);var i=new XMLHttpRequest;i.open("GET",t),i.responseType="arraybuffer",i.onload=go,i.send(),wt=4}function go(t){console.log("+++++ callback +++++"),clearTimeout(Vr);for(var i=t.target,e=i.response,r=e.byteLength,a=new Int8Array(e),s=Hr.memRef(),n=new Int8Array(et.buffer,s,r),h=0;h<r;h++)n[h]=a[h];n[r]=0,console.log("===== exp.wasm ====="),Hr.wasm(),wt=5,Ct=1,console.log("----- callback -----")}var ft;function yo(){ft=new da}var da=function(){wt&&so(),this.ChangeViewTiles=function(t,i){var e=F.rotation.y;dt(e,0),Oi==51.50706135&&ve!=3&&(Br($("vil",17)*1),pe<14&&Br(14),pe>19&&Br(19),ih($("tiles",Pe)*1));var r=qr(t,pe),a=Ur(i,pe),s=_i(a+1,pe),n=Si(r,pe),h=_i(a,pe),l=Si(r+1,pe);if(Oi==51.50706135){var f=[0,0];!$("km",0)*1&&(f=dt(Da,qa)),as=n,Oi=s,$o(F.position.x=tt(t,i)-f[0],F.position.z=it(i)+f[1]),j&&j.Flight&&j.Flight.flightObj&&(j.Flight.flightObj.position.copy(F.position),j.Flight.flightObj.rotation.copy(F.rotation))}this.lastLoadx=tt(n,s),this.lastLoadz=it(s),this.lastLoadEx=tt(l,s),this.lastLoadEz=it(h),Xt&&Xt.position.set(this.lastLoadx,X*6,this.lastLoadz),Qt(a,r,2);for(var d=a-Pe;d<=a+Pe;d++)for(var u=r-Pe;u<=r+Pe;u++){var v=Math.abs(u-r),y=Math.abs(d-a),m=Math.max(y,v);m<=Os?Qt(d,u,2):m<=Pe?Qt(d,u,1):Qt(d,u,0)}for(var d in J)for(var u in J[d]){var w=J[d][u],y=Math.abs(w.latIndex-a),v=Math.abs(w.lonIndex-r),m=Math.max(y,v);m>Pe?Qt(d,u,0):m>Os?Qt(d,u,1):Qt(d,u,2)}},this.LoadTiles=function(){if(!We&&wt!=2){var t=pe-At,i=F.Lon(),e=F.Lat(),r=qr(i,t),a=Ur(e,t),y=0,m=0,s=0,n=9e9;if(Nt){T>1&&p("Overpass: SIMULATION"),Nt==1&&(nh(2),Ct=JSON.parse(JSON2));return}s=!1;for(var h in vt)for(var l in vt[h]){var f=vt[h][l];if(f.state==1){var d=Math.abs(f.latIndex-a),u=Math.abs(f.lonIndex-r),v=Wi(d,u);n>v&&(n=v,s=f)}}if(s){var y=_i(s.latIndex+1,t),m=Si(s.lonIndex,t),w=_i(s.latIndex,t),M=Si(s.lonIndex+1,t);s.state=2,We=s,ht(1);var x=We.latIndex,b=We.lonIndex,P=Math.pow(2,At);ji=x*P,Ki=b*P,ea=x*P+P-1,ta=b*P+P-1;var G=+y.toFixed(8)+","+m.toFixed(8)+","+w.toFixed(8)+","+M.toFixed(8),S=be+"api.openstreetmap.fr/oapi",S=be+"overpass.openstreetmap.ru/api",S=be+"overpass.osm.ch/api",S=be+"maps.mail.ru/osm/tools/overpass/api",S=be+"overpass.osm.jp/api",S=be+"overpass.private.coffee/api",S=be+"overpass-api.de/api/interpreter?data=[out:json];(rel( "+G+");";if(qt?S+='node["generator:source"="wind"]('+G+');node["place"]('+G+");":S+="node("+G+");",S+="way( "+G+");  (._;>;););out;",na==3&&(S="http://85.214.118.251:8080/all/"+(pe+At)+"/"+b+"/"+x+".topojson",p("URL3:"+S)),ve==2&&(S=be+"overpass-api.de/api/interpreter?data=[out:json];( rel( "+G+"); way( "+G+");  (._;>;););out;"),!(ns>jo)){if(wt)vo(S);else{var E=new XMLHttpRequest;E.onreadystatechange=function(){E.readyState==4&&E.status==200&&(T>1&&p("Overpass: Query beantwortet "+new Date().toLocaleTimeString()),clearTimeout(Vr),Ct=JSON.parse(E.responseText),T>1&&p("Overpass: Text ausgewertet "+new Date().toLocaleTimeString()))},E.onprogress=function(_){T>3&&p("onprogress - loaded,total: ",_.loaded,_.total)},E.timeout=function(_){Es()},E.open("GET",S,!0),E.send()}Vr=setTimeout(Es,25*1e3),T>1&&p("Overpass: "+s.lonIndex+"/"+s.latIndex+" "+new Date().toLocaleTimeString()),T>3&&p(S)}}}},this.readJsonData=function(){if(wt==5)return wt=3,Ct=0,!1;if(na==3)return Ct=0,!1;bi==0&&(xi=Ct,Ct=0);for(var t=ua,i=0;t>0;){if(!xi)return p(" Keine element-liste? Kommt vor. URL= "+Fs),!1;if(!xi.elements[bi])return p(" Keine elemente? Kommt vor. URL= "+Fs),!1;var e=xi.elements[bi];if(e.type=="node"){var r=new N(e.id,e.lat,e.lon),a=e.tags;for(var s in a)r.id&&r.AddTag(s,a[s]);if(e.id==3815077900&&wo(),e.id==5171826742&&p("osm Found: repo Node 5171826742"),e.id==297042815){var n=H[297042815];Di(4798,"server","car",n.x,n.z,"obj")}if(e.id==254014474&&ve==3&&(r.typeMain="Mdl:hide"),e.id==3195289796){p("node id  3195289796: Add Model Alexanderplatz #####################################");var h=new _e("4711");h.id>0&&(h.AddTag("type","3d_model"),h.AddTag("server","osm_go"),h.AddTag("model","DE_berlin_alexanderplatz"),h.AddMember("3195289796","node","center"),h.AddMember("304987177","way","hide"),h.AddMember("4065110","rel","hide"),h.AddMember("326772329","way","hide"),h.AddMember("230818931","way","hide"),h.AddMember("217537052","way","hide"),h.AddMember("397891642","way","hide"),h.AddMember("96880477","way","hide"),h.AddMember("304987174","way","hide"),h.AddMember("304987173","way","hide"),h.AddMember("304987172","way","hide"),h.AddMember("304987176","way","hide"),h.AddMember("96880470","way","hide"))}if(e.id==1659791900){p("node id 1659791900: Add Model London Eye #####################################");var h=new _e("4712");h.id>0&&(h.AddTag("type","3d_model"),h.AddTag("server","osm_go"),h.AddTag("model","UK_london_eye"),h.AddMember("1659791900","node","center"))}if(e.id==3722134520){p("node id 3722134520 Add Model ''Dubai Hotel'' #####################################");var h=new _e("4714");h.id>0&&(h.AddTag("type","3d_model"),h.AddTag("server","osm_go"),h.AddTag("model","AE_dubai_hotel"),h.AddTag("format","dae"),h.AddMember("3722134520","node","center"),h.AddMember("12700546","way","hide"))}if(e.id==4397379799){p("node id 4397379799: Add Model ''Atomium'' #####################################");var h=new _e("4715");h.id>0&&(h.AddTag("type","3d_model"),h.AddTag("server","osm_go"),h.AddTag("model","BE_brussels_atomium"),h.AddTag("format","dae"),h.AddMember("4397379799","node","center"),h.AddMember("442046313","way","hide"),h.AddMember("442102754","way","hide"),h.AddMember("388842414","way","hide"),h.AddMember("442046315","way","hide"),h.AddMember("1243821","rel","hide"),h.AddMember("442044563","way","hide"))}if(e.id==1612269507){p("node id 1612269507: Add Model ''Orion Zeigermann'' #####################################");var h=new _e("4717");h.id>0&&(h.AddTag("type","3d_model"),h.AddTag("server","osm_go"),h.AddTag("model","orion"),h.AddTag("format","obj"),h.AddMember("1612269507","node","center"))}if(e.id==383352481&&mt[4718]===void 0){p("node id 383352481: Add Model ''Orion ohne Lift'' #####################################");var h=new _e("4718");h.id>0&&(h.AddTag("type","3d_model"),h.AddTag("server","osm_go"),h.AddTag("model","orion_"),h.AddTag("format","obj"),h.AddMember("383352481","node","center"))}}if(e.type=="way"){var l=new B(e.id),f=e.nodes;for(var d in f){var u=f[d];l.id&&l.AddNode(u)}var v=e.tags;for(var s in v)l.id&&l.AddTag(s,v[s]);if(e.id==204068874&&(l.typeMain="Mdl:Eye"),e.id==550964809&&ve==3&&(l.typeMain="Mdl:hide"),e.id==24261269&&ve==3){l.typeMain="Mdl:hide";var y=l.wayNodes[0],n=H[y];Di(4903,"server","Parkhaus",n.x,n.z,"obj")}yi>0&&(e.id==308021389&&(l.typeMain="Mdl:hide"),e.id==308021390&&(l.typeMain="Mdl:hide"),e.id==69034180&&(l.typeMain="Mdl:hide"),e.id==69034127&&(l.typeMain="Mdl:hide"),e.id==69034135&&(l.typeMain="Mdl:hide"),e.id==69034179&&(l.typeMain="Mdl:hide"),e.id==308145259&&(l.typeMain="Mdl:hide"),e.id==308145258&&(l.typeMain="Mdl:hide"),e.id==308021391&&(l.typeMain="Mdl:hide"),e.id==308687749&&(l.typeMain="Mdl:hide"),e.id==308687747&&(l.typeMain="Mdl:hide"),e.id==442046313&&(l.typeMain="Mdl:hide"),e.id==442102754&&(l.typeMain="Mdl:hide"),e.id==388842414&&(l.typeMain="Mdl:hide"),e.id==442046315&&(l.typeMain="Mdl:hide"),e.id==442044563&&(l.typeMain="Mdl:hide"),e.id==12700546&&(l.typeMain="Mdl:hide"),e.id==308145239&&(l.typeMain="Mdl:Eiffel"),e.id==308145237&&(l.typeMain="Mdl:Eiffel"),e.id==308145236&&(l.typeMain="Mdl:Eiffel"),e.id==308145233&&(l.typeMain="Mdl:Eiffel"),e.id==308145234&&(l.typeMain="Mdl:Eiffel"),e.id==308687749&&(l.typeMain="Mdl:Eiffel"),e.id==308687746&&(l.typeMain="Mdl:Eiffel"),e.id==308687755&&(l.typeMain="Mdl:Eiffel"),e.id==308687751&&(l.typeMain="Mdl:Eiffel"),e.id==308687744&&(l.typeMain="Mdl:Eiffel"),e.id==308687754&&(l.typeMain="Mdl:Eiffel"),e.id==308687750&&(l.typeMain="Mdl:Eiffel"),e.id==308687747&&(l.typeMain="Mdl:Eiffel"),e.id==308687748&&(l.typeMain="Mdl:Eiffel"),e.id==308687745&&(l.typeMain="Mdl:Eiffel"),e.id==308687753&&(l.typeMain="Mdl:Eiffel"),e.id==308687752&&(l.typeMain="Mdl:Eiffel"),e.id==308689165&&(l.typeMain="Mdl:Eiffel"),e.id==308689166&&(l.typeMain="Mdl:Eiffel"),e.id==308689167&&(l.typeMain="Mdl:Eiffel"),e.id==308689164&&(l.typeMain="Mdl:Eiffel"))}if(e.type=="relation"){if(T>3&&p("relation id/type:",e.id,e.tags.type),!e.tags)T>2&&at("Relation without tags "+e.id);else{e.tags.type=="3d_model"&&p("############ MODEL: ");var m=e.tags,w=new _e(e.id);for(var s in m)w.id&&w.AddTag(s,m[s]),T>3&&p("rel-tag/val: ",s,m[s]);var M=e.members;for(var x in M){var b=M[x];T>4&&p("rel-member-Nr/ref/type/role: ",x,b.ref,b.type,b.role),w.id&&w.AddMember(b.ref,b.type,b.role)}}yi>0&&(e.id==1243821&&(w.typeMain="Mdl:rel-Atom"),e.id==4114840&&(w.typeMain="Mdl:rel-Eiffel"),e.id==4114841&&(w.typeMain="Mdl:rel-Eiffel"),e.id==4114842&&(w.typeMain="Mdl:rel-Eiffel"),e.id==4114838&&(w.typeMain="Mdl:rel-Eiffel"),e.id==4114839&&(w.typeMain="Mdl:rel-Eiffel"),e.id==4065110&&(w.typeMain="Mdl:rel-Alex"))}if(bi++,bi>=xi.elements.length)return bi=0,xi=void 0,T>1&&p("Overpass: DATEN VERARBEITET "+new Date().toLocaleTimeString()),!1;i=pa.getDelta(),t-=i}return!0}};da.prototype.readJsonData=function(){return this.readJsonData()};da.prototype.QueryOsmTiles=function(t,i){this.ChangeViewTiles(t,i)};da.prototype.LoadOsmTiles=function(){this.LoadTiles()};da.prototype.IsOsmDataAvail=function(){return Ct!=0};function wo(){if(!H[101]){var t=new St(1111,1111,1,1),i=new V(t,o.white);i.name="NodesExebitionPlace",i.rotation.x=k(90),re.add(i);var e=0,r=0,a=100,s=3e-5,n;r+=s,a++,n=new N(a,e,r),n.AddTag("amenity","pub"),r+=s,a++,n=new N(a,e,r),n.AddTag("information","guidepost"),r+=s,a++,n=new N(a,e,r),n.AddTag("man_made","flagpole"),r+=s,a++,n=new N(a,e,r),n.AddTag("man_made","surveillance"),r+=s,a++,n=new N(a,e,r),n.AddTag("highway","bus_stop"),n.AddTag("public_transport","platform"),r+=s,a++,n=new N(a,e,r),n.AddTag("seamark","any"),r+=s,a++,n=new N(a,e,r),n.AddTag("historic","memorial"),n.AddTag("memorial:type","stolperstein"),r+=s,a++,n=new N(a,e,r),n.AddTag("historic","wayside_cross"),r=0,e-=s,r+=s,a++,n=new N(a,e,r),n.AddTag("amenity","bench"),r+=s,a++,n=new N(a,e,r),n.AddTag("amenity","grit_bin"),r+=s,a++,n=new N(a,e,r),n.AddTag("amenity","waste_basket"),r+=s,a++,n=new N(a,e,r),n.AddTag("amenity","vending_machine"),r+=s,a++,n=new N(a,e,r),n.AddTag("amenity","atm"),r+=s,a++,n=new N(a,e,r),n.AddTag("amenity","clock"),r+=s,a++,n=new N(a,e,r),n.AddTag("amenity","table"),r+=s,a++,n=new N(a,e,r),n.AddTag("amenity","telephone"),r=0,e-=s,r+=s,a++,n=new N(a,e,r),n.AddTag("amenity","post_box"),r+=s,a++,n=new N(a,e,r),n.AddTag("amenity","parking"),r+=s,a++,n=new N(a,e,r),n.AddTag("amenity","recycling"),r+=s,a++,n=new N(a,e,r),n.AddTag("amenity","fountain"),r+=s,a++,n=new N(a,e,r),n.AddTag("amenity","public_bookcase"),r+=s,a++,n=new N(a,e,r),n.AddTag("amenity","taxi"),r+=s,a++,n=new N(a,e,r),n.AddTag("amenity","drinking_water"),r+=s,a++,n=new N(a,e,r),n.AddTag("amenity","toilets"),r=0,e-=s,r+=s,a++,n=new N(a,e,r),n.AddTag("tourism","artwork"),r+=s,a++,n=new N(a,e,r),n.AddTag("information","board"),r+=s,a++,n=new N(a,e,r),n.AddTag("advertising","column"),r+=s,a++,n=new N(a,e,r),n.AddTag("place","usburb"),r+=s,a++,n=new N(a,e,r),n.AddTag("traffic_signXXX","XXX"),r+=s,a++,n=new N(a,e,r),n.AddTag("addr:postcode","AB12"),r+=s,a++,n=new N(a,e,r),n.AddTag("communication:mobile_phone","any"),r=0,e-=s,r+=s,a++,n=new N(a,e,r),n.AddTag("highway","street_lamp"),r+=s,a++,n=new N(a,e,r),n.AddTag("highway","stop"),r+=s,a++,n=new N(a,e,r),n.AddTag("highway","give_way"),r+=s,a++,n=new N(a,e,r),n.AddTag("highway","traffic_signals"),r+=s,a++,n=new N(a,e,r),n.AddTag("highway","crossing"),n.AddTag("crossing","island"),r+=s,a++,n=new N(a,e,r),n.AddTag("highway","crossing"),n.AddTag("crossing","zebra"),r=0,e-=s,r+=s,a++,n=new N(a,e,r),n.AddTag("cycleway","asl"),r+=s,a++,n=new N(a,e,r),n.AddTag("emergency","fire_hydrant"),r+=s,a++,n=new N(a,e,r),n.AddTag("emergency","phone"),r+=s,a++,n=new N(a,e,r),n.AddTag("railway","signal"),r+=s,a++,n=new N(a,e,r),n.AddTag("railway","milestone"),r+=s,a++,n=new N(a,e,r),n.AddTag("railway","subway_entrance"),r=0,e-=s,r+=s,a++,n=new N(a,e,r),n.AddTag("barrier","bollard"),r+=s,a++,n=new N(a,e,r),n.AddTag("barrier","???"),r+=s,a++,n=new N(a,e,r),n.AddTag("natural","tree"),r+=s,a++,n=new N(a,e,r),n.AddTag("power","generator"),n.AddTag("generator:source","wind"),r+=s,a++,n=new N(a,e,r),n.AddTag("leisure","picnic_table"),r+=s,a++,n=new N(a,e,r),n.AddTag("leisure","playground"),new B(90)}}class ss extends _t{constructor(i=new Ke([new ee(.5,.5),new ee(-.5,.5),new ee(-.5,-.5),new ee(.5,-.5)]),e={}){super(),this.type="WedgeGeometry",this.parameters={shape:i,options:e};var r=e.depth;const a=e.center!==void 0?e.center:[0,0];this.parameters.options.center=a,e.angle;var s=i.extractPoints().shape,n=i.extractPoints().holes;if(new Ke,!Oa.isClockWise(s)){s=s.reverse();for(let S=0;S<n.length;S++){const E=n[S];Oa.isClockWise(E)&&(n[S]=E.reverse())}}const l=[];var f,d,u;for(let S=0;S<s.length;S++){f=s[S];const E=this.move(f);S===0?(d=E[1],u=E[1]):(d=Math.min(d,E[1]),u=Math.max(u,E[1])),l.push(E)}const v=this.splitShape(l),y=[],m=v.length>1?1:0;for(let S=m;S<v.length;S++){s=v[S].extractPoints().shape;const E=Oa.triangulateShape(s,n);for(let _=0;_<E.length;_++){const A=E[_];for(let O=0;O<3;O++){const W=this.unMove([s[A[O]].x,s[A[O]].y]),Y=W[0],L=W[1];var w;s[A[O]].y>=0?w=r-r/u*s[A[O]].y:w=r-r/d*s[A[O]].y,y.push(Y,L,w)}}}var M=y.length/3;s=v[0].extractPoints().shape;for(let S=0;S<s.length;S++){var f=s[S],x;f.y>=0?x=r-r/u*f.y:x=r-r/d*f.y;var b;S===s.length-1?b=s[0]:b=s[S+1];var P;b.y>=0?P=r-r/u*b.y:P=r-r/d*b.y,y.push(...this.unMove([f.x,f.y]),0),y.push(...this.unMove([f.x,f.y]),x),y.push(...this.unMove([b.x,b.y]),0),y.push(...this.unMove([f.x,f.y]),x),y.push(...this.unMove([b.x,b.y]),P),y.push(...this.unMove([b.x,b.y]),0)}var G=new Ae(new Float32Array(y),3);this.setAttribute("position",G),this.setAttribute("uv",new Ae(new Float32Array([1,1]),2)),this.computeVertexNormals(),this.groups.push({start:0,count:M,materialIndex:0}),this.groups.push({start:M,count:y.length,materialIndex:1})}splitShape(i){const e=[],r=new Ke;var a=[],s=[],n=i[i.length-1];for(let M=0;M<i.length-1;M++){a=i[M],M===0?r.moveTo(a[0],a[1]):r.lineTo(a[0],a[1]),s=i[M+1];const x=a[1]===0,b=n[1]>0==s[1]>0,P=a[1]>0!=s[1]>0;if(x&&!b||P){var h;if(x)h=a[0];else var l=(s[1]-a[1])/(s[0]-a[0]),h=a[0]-a[1]/l;e[M]=h,x||r.lineTo(h,0)}n=a}if(r.lineTo(s[0],s[1]),Object.keys(e).length===0)return[r];var f=[];for(const M in e)f.push(e[M]);f.sort(function(M,x){return M-x});for(var d in e){const M=e[d];e[d]={value:M,number:f.indexOf(M)}}const u=[],v=[],y=[];var m=-1,w=new Ke;for(let M=0;M<i.length;M++)a=i[M],M===0?w.moveTo(a[0],a[1]):w.lineTo(a[0],a[1]),M in e&&(h=e[M],h.value!==a[0]&&w.lineTo(h.value,0),h.number===m?(u.push(w),w=y.pop(),m=v.pop(),w.lineTo(h.value,0)):(y.push(w),v.push(m),w=new Ke,m=h.number+2*((h.number+1)%2)-1,w.moveTo(h.value,0)));return u.push(w),u.unshift(r),u}move(i){const e=-this.parameters.options.angle,r=this.parameters.options.center,a=(i.x-r[0])*Math.cos(e)-(i.y-r[1])*Math.sin(e),s=-(i.x-r[0])*Math.sin(e)-(i.y-r[1])*Math.cos(e);return[a,s]}unMove(i){const e=this.parameters.options.angle,r=this.parameters.options.center,a=i[0]*Math.cos(e)+i[1]*Math.sin(e)+r[0],s=-1*i[0]*Math.sin(e)+i[1]*Math.cos(e)-r[1];return[a,s]}static fromJSON(i,e){return new ss(e,i.options)}}B.prototype.Building=function(t,i){if(this.id*1==Gt)p("Building:",this.id);else if(Ut)return;i||(i=t),this.GetTag("building");var e=this.GetTag("building:part");if(!(e=="no"&&(e=!1,fi>0))&&!(e&&(ko(),fi<0))){var r=void 0,a=Yr,s=[],n=void 0,h=0,l=0,w=0;if(this.wayNodes.length<4){at("Building with less than 3 Nodes! Way-ID:"+this.id,this);return}this.wayNodes.length*.4;for(var A in this.wayNodes){var f=H[this.wayNodes[A]];s.push(new ee(f.x,f.z)),n&&f.x==n.x&&f.z==n.z&&at("way ID"+this.id+": position node "+(A-1)+"="+A,this),n=f,A!=0&&(f.partWay&&(h==0?h=f.partWay:h!=1&&h!=f.partWay&&(h=1)),(f.GetTag("entrance")||f.GetTag("addr:housenumber")||f.GetTag("shop")||f.GetTag("office"))&&f.Entrance(this.AngleAtNode(A)))}var d=new Ke(s),u=Math.abs(Oa.area(s));typeof this.holes<"u"&&(d.holes=this.holes),u/=4,Yr!=0?a=Yr:(a=Math.sqrt(u),a>16&&(a=2*16-a,a<3*te&&(a=3*te)));var v,y,m;(v=this.GetTag("building:levels",!1,!0)*1)&&(a=v*te),(v=this.GetTag("levels",!1,!0)*1)&&(a=v*te),(v=this.GetTag("building:max_level",!1,!0)*1)&&(a=(v+1)*te),(y=this.GetTag("building:min_level",!1,!0)*1)&&(l=y*te),(y=this.GetTag("min_level",!1,!0)*1)&&(l=y*te),(m=this.GetTag("height",!1,!0)*1)&&(a=m*1),(m=this.GetTag("building:height",!1,!0)*1)&&(a=m*1),(m=this.GetTag("min_height",!1,!0)*1)&&(l=m*1),(m=this.GetTag("building:min_height",!1,!0)*1)&&(l=m*1);var w=this.GetTag("roof:height",0)*1;w==0&&(w=this.GetTag("roof:levels",0)*te,w!=0&&(a+=w)),a<l&&(a+=l),(Ge<0||this.GetTag("indoor"))&&(a=te*.8,t=i=o.buildingIndoor);var M;(M=this.GetTag("level",!1,!0))&&!this.GetTag("min_height",!1,!0)&&(l+=M*1*te,a+=M*1*te),Ge<0&&!this.GetTag("min_height",!1,!0)&&(l+=Ge,a+=Ge),this.GetTag(this.typeMain)=="roof"&&(a=te,l=a-te*.2),a<=4*te&&u<400&&!e&&i==o.building&&(i=o.buildingRoof);var x;(x=this.GetTag("building:colour"))&&(t=Ia(x,1,this,!0)),(x=this.GetTag("roof:colour"))&&(i=Ia(x,2,this,!0)),fe>1&&this.filter&&(t=Ee,i=Ee);var b=[i,t],P=b,G=mo(this,l,a,w,s,b);G&&(w=G.roofHeight);var S=new xe,E=a-w-l;isNaN(E)&&(E=3.333);var _=new fn(d,{depth:E,bevelEnabled:!1});_.applyMatrix4(S.makeRotationX(k(90))),_.applyMatrix4(S.makeTranslation(0,E+l,0));var A=Math.floor(this.wayNodes.length/2),O=H[this.wayNodes[A]],W=Math.abs(O.x-vi),Y=Math.abs(O.z-gi),L=Wi(W,Y),Z=L<Ka;if(Z&&(O=1),Ci==0||Z)r=new V(_,P),r.castShadow=r.receiveShadow=R,r.name="WB"+this.id,r.osm=this,G&&r.add(G),ao(r,this.wayNodes[0]),this.mesh=r;else{var ne=0;if(_.groups[0].materialIndex=i.iCol,_.groups[1].materialIndex=t.iCol,_.osm=this,Ds(_,ne,this.wayNodes[0]),G){var _=G.geometry.translate(G.position.x,G.position.y,G.position.z);_.groups.length&&(_.groups[0].materialIndex=i.iCol,_.groups[1].materialIndex=t.iCol),Ds(_,i.iCol,this.wayNodes[0])}}}};function mo(t,i,e,r,a,s){var n=new Ke(a),h;if(!(h=t.GetTag("roof:shape"))&&!(h=t.GetTag("building:roof:shape")))if(a.length==5&&s[0]==o.buildingRoof)h="gabled";else return 0;var l=-1e9,f=-1e9,d=1e9,u=1e9;for(var v in a)l=Math.max(l,a[v].x),f=Math.max(f,a[v].y),d=Math.min(d,a[v].x),u=Math.min(u,a[v].y);var y=(d+l)/2,m=(u+f)/2,w=t.GetTag("roof:orientation")=="across";switch(r>e&&(r=e),h){case"flat":return;case"pyramidal":r==0&&(r=(l-d)/2,r>e/2&&(r=e/2));var x=0,q=new _t,A=[],O=[];A.push(0,0,0);for(x in a)A.push(a[x].x-y,-r,a[x].y-m),x*1>0&&O.push(0,x*1,x*1+1);q.setAttribute("position",new Ae(new Float32Array(A),3)),q.setAttribute("uv",new Ae(new Float32Array([1,1]),2)),q.setIndex(O),q.computeVertexNormals(),q.osm=t;var Me=s[0];break;case"dome":r==0&&(r=(l-d)/2,r>e/2&&(r=e/2));var q=new _t,A=[],O=[],_=0,M=6,x=0;for(x in a)for(var b=a[x].x-y,P=a[x].y-m,G=0;G<=90;G+=90/M){var S=dt(k(G));A.push(b*S[1],-r*(1-S[0]),P*S[1]),_++,x>0&&G>0&&(O.push(_-1,_-0-2,_-M-2),O.push(_-2,_-M-3,_-M-2))}q.setAttribute("position",new Ae(new Float32Array(A),3)),q.setAttribute("uv",new Ae(new Float32Array([1,1]),2)),q.setIndex(O),q.computeVertexNormals(),q.osm=t;var Me=s[1];break;case"onion":r==0&&(r=(l-d)*1.5);var E=[[1,0],[1.12,.09],[1.27,.15],[1.36,.27],[1.28,.42],[1.1,.51],[.95,.53],[.62,.58],[.49,.61],[.21,.69],[.1,.79],[0,1]],_=-2,q=new _t,A=[],O=[];for(x in a)if(x!=0){var W=a[x-1].x-y,Y=a[x-1].y-m,L=a[x-0].x-y,Z=a[x-0].y-m;for(var v in E){var ne=E[v][0],De=E[v][1]*r-r;A.push(W*ne,De,Y*ne),A.push(L*ne,De,Z*ne),v>0&&(O.push(_+0,_+2,_+1),O.push(_+1,_+2,_+3)),_+=2}}q.setAttribute("position",new Ae(new Float32Array(A),3)),q.setAttribute("uv",new Ae(new Float32Array([1,1]),2)),q.setIndex(O),q.computeVertexNormals(),q.osm=t;var Me=s[0];break;case"skillion":r==0&&(r=(l-d)/10,r>e/2&&(r=e/2));var Ne=new xe,q=new fn(n,{depth:e-i,bevelEnabled:!1});q.applyMatrix4(Ne.makeRotationX(k(90))),y=m=0;var K=Ps(a);w||(K+=k(90));var ie=t.GetTag("roof:slope:direction",!1,!0);ie&&(K=k(90-ie));var ie=t.GetTag("roof:direction",!1,!0);ie&&(K=k(90-ie)),K>k(360)&&(K-=k(360)),K<k(0)&&(K+=k(360)),q.applyMatrix4(Ne.makeRotationY(-K));var l=-1e9,d=1e9,I=q.attributes.position.array.length/3;a.length-1;for(var ce=q.attributes.position.array,v=0;v<I;v++){var b=ce[v*3];l=Math.max(l,b),d=Math.min(d,b)}for(var ge=r/(l-d),v=0;v<I;v++){var Ot=ce[v*3+1];if(Ot>=-.001){var b=ce[v*3+0],Ft=(b-d)*ge;ce[v*3+1]=-Math.abs(Ft)}}q.applyMatrix4(Ne.makeRotationY(+K)),q.osm=t;var Me=s;r=e-i;break;case"gabled":var rt=Ps(a);r==0&&(r=(l-d)/10,r>e/2&&(r=e/2)),w&&(rt=rt>k(90)?rt-k(90):rt+k(90));const c={center:bo(a),angle:rt,depth:r};y=m=0;var q=new ss(n,c),Ne=new xe;q.applyMatrix4(Ne.makeRotationX(k(-90))),q.applyMatrix4(Ne.makeTranslation(0,-r,0)),q.osm=t;var Me=s;break;default:return 0}typeof q.faces<"u"&&q.faces.length!=q.faceVertexUvs[0].length&&alert("mist vertex roof");var se=new V(q,Me);return se.position.x=y,se.position.z=m,se.position.y=e,se.castShadow=se.receiveShadow=R,se.osm=t,se.roofHeight=r,se}function bo(t){const i=mn(t);return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function Ps(t){const i=xo(t),e=Mo(t);var r,a=0;for(let h=0;h<i.length;h++)i[h]>a&&(r=h,a=i[h]);var s=e[r],n=mn(t,-s);return n[3]-n[1]>n[2]-n[0]&&(s=s>0?s-Math.PI/2:s+Math.PI/2),s}function xo(t){const i=[];var e,r;for(let a=0;a<t.length-1;a++)e=t[a],r=t[a+1],i.push(Math.sqrt((e.x-r.x)**2+(e.y-r.y)**2));return i}function Mo(t){var i=t.length-1;(t[0].x!=t[i].x||t[0].y!=t[i].y)&&t.push(t[0]);const e=[];var r,a;for(let s=0;s<t.length-1;s++){r=t[s],a=t[s+1];let n=Math.atan2(a.y-r.y,a.x-r.x);n>=Math.PI?n-=Math.PI:n<-Math.PI&&(n+=2*Math.PI),e.push(n)}return e}function mn(t,i=0){var e=[],r=[],a;for(let f=0;f<t.length;f++)a=t[f],e.push(a.x*Math.cos(i)-a.y*Math.sin(i)),r.push(a.x*Math.sin(i)+a.y*Math.cos(i));const s=Math.min(...e),n=Math.min(...r),h=Math.max(...e),l=Math.max(...r);return[s,n,h,l]}var ue=[];function To(){ue=[]}var ns=0,ra=void 0,bn=0;function ko(){bn++}var Ge=0;function os(t){Ge=t}var Fa=0,li,qi=!1,ni=!1;function So(){ns=0,ra=void 0,Fa=0}function B(t){if(t==99*249958667&&p("wwww Debug: Way ID: ",t),t==0&&(t=ja,fs()),ue[t]){this.id=0;return}ns++,this.id=t,this.tags=[],this.values=[],this.wayNodes=[],this.typeMain=void 0,this.filter=fe>1,me&&this.id.toString().indexOf(me)>=0&&(gt.push(this),this.filter=!1),t!=0&&(ue[t]=this,Fa&&(Fa.next=this),Fa=this,ra||(ra=this),T>=4&&p("new Way ",t))}B.prototype.AddNode=function(t){if(this.wayNodes===void 0){p("MIST!wn",this,t);return}this.wayNodes.push(t)};B.prototype.AddTag=function(t,i){this.tags===void 0&&(p("tags MIST!wt",this,t,i),this.tags=[],this.values=[]),t=t.replace("color","colour"),this.tags.push(t),this.values.push(i),me&&(t.indexOf(me)>=0||i.indexOf(me)>=0)&&(gt.push(this),this.filter=!1)};B.prototype.GetTag=function(t,i,e){for(var r in this.tags)if(this.tags[r]==t){var a=this.values[r],s=a.split(";");s.length>1&&(a=s[0]),a=a.replace(",",".");try{var n=a.split(" ")}catch{p("catchhh")}return n.length>1&&n[1]=="m"&&(a=n[0]),a[a.length-1]=="'"&&(a=a.substr(0,a.length-1)*.3048),a[a.length-1]=="m"&&a[0]>="0"&&a[0]<="9"&&(a=a.substr(0,a.length-1)*1),a=="1-"&&(a="-1"),e&&isNaN(a*1)?(p("Real-Value ("+a+") NaN? way id "+this.id),i):a}return i||i==0?i:!1};B.prototype.WayTag=function(t){for(var i in this.tags)this.tags[i]==t&&(this.tags[i]="highway")};B.prototype.AngleAtNode=function(t){var i=t*1+1;t>0&&(i=t*1-1);var e=H[this.wayNodes[i]],r=H[this.wayNodes[t]],a=e.x-r.x,s=e.z-r.z;return kt(Math.atan2(a,s))};B.prototype.Shape=function(t,i,e){var r,a=[];for(var s in this.wayNodes){var n=H[this.wayNodes[s]];if(r&&n.x==r.x&&n.z==r.z){ir("Way:"+this.id+" Node "+r.id+"="+n.id,this);continue}a.unshift(new ee(n.x,n.z)),T>=5&&p("Shape-Node: ",s,this.wayNodes[s],n.x,n.z),n.GetTag("entrance")&&n.Entrance(this.AngleAtNode(s)),r=n}if(this.wayNodes.length<4&&T>2&&at("Shape with <3(+1) Nodes! Way-ID:"+this.id),!(this.wayNodes.length<4)){var h=new Ke(a);if(!t)return h;typeof this.holes<"u"&&(h.holes=this.holes),fe>1&&this.filter&&(t=Ee),Ge<0&&(i=0);var l=new Ha(h),f=new xe;f.makeRotationX(k(90)),l.applyMatrix4(f);var d=new V(l,t);d.position.y=Ge+i,d.position.y>=-.5&&(d.receiveShadow=R),d.osm=this;var u=Math.floor(this.wayNodes.length/2);e?wi(d,this.wayNodes[u]):pi(d,this.wayNodes[u])}};B.prototype.PowerLine=function(t,i){fe>1&&this.filter&&(t=Ee);var e=new la(.2,.3,20,16);e.groups=[];var r=17,a=20/2-1;if(this.GetTag("power")=="line"){var s=30,n=s/2,h=s/25,l=s/15,f=new g().cyl(0,h,n,4).roty(45).rotz(95.5).trans(-n/1.85,s*1.02,0),d=new g().cyl(0,h,n,4).roty(-45).rotz(-95.5).trans(+n/1.85,s*1.02,0),u=new g().cyl(0,h,s/3,4).roty(45).trans(0,s+s/3/2,0),e=new g().cyl(h,l,s,4).roty(45).trans(0,s/2,0).merge(f).merge(d).merge(u).geometry;e.groups=[],t=o.line,r=s,a=0}var v=new _t,y=[];for(var m in this.wayNodes){var b=H[this.wayNodes[m]];if(!b.typeMain){b.typeMain="powerline";var w=t,M=this.AngleAtNode(this.wayNodes.indexOf(b.id));y.push(b.x,r,b.z);var x=new V(e,w);x.position.y=a,x.position.x=b.x,x.position.z=b.z,x.rotation.y=k(M),x.osm=b,x.castShadow=R,x.receiveShadow=R,i&&pi(x)}}v.setAttribute("position",new Ae(new Float32Array(y),3)),v.setAttribute("uv",new Ae(new Float32Array([1,1]),2)),v.computeVertexNormals();var x=new dn(v,w);x.osm=this,i?(x.castShadow=R,x.receiveShadow=R):x.position.y=-30;var b=Math.floor(this.wayNodes.length/2);pi(x,this.wayNodes[b])};const Je=[];Je.cream="yellow";Je.light_brown="brown";Je.light_grey="lightgrey";Je["light grey"]="lightgrey";Je.light_green="lightgreen";Je["yellow-brown"]="yellow";Je.maron="maroon";Je.dark_grey="darkgrey";Je.dark_green="darkgreeen";Je.grez="grey";Je["red-brown"]="#D21515";function Ia(t,i,e,r){t.indexOf("0x")==0&&p("chroma 0x ok?"),Je[t]&&(t=Je[t]),t=t.replace("-"," "),t=t.replace("_","");try{t=ur(t).hex()}catch{try{var a=t.split(" ");a[0]=="light"?t=ur(a[1]).brighten().hex():t=ur.mix(a[0],a[1]).hex();var s=new ut({color:t,side:Qe,transparent:!1,opacity:Ra});return s.iCol=D.length,s.name=t,D.push(s),s}catch(h){return ir("Bad colour: "+t,e,h),o.sky}}ve==1&&(r?t=0:t=16777215);var s=new ut({color:t,side:Qe,transparent:!1,opacity:Ra});return s.iCol=D.length,s.name=t,D.push(s),s}B.prototype.Fence=function(t,i){i||(i=1.4);var e=new _t,r=[],a=[];for(var s in this.wayNodes){var n=H[this.wayNodes[s]],h=n.x,l=n.z,f=this.GetTag("min_height",0,!0)*1,i=this.GetTag("height",i,!0)*1-f,d=this.GetTag("fence_type");d=="railing"&&(t=o.grey),d=="concrete"&&(t=o.white),d=="wood"&&(t=o.amenity_brown),r.push(h,0,l,h,i,l)}for(var s=0;s<this.wayNodes.length-1;s++){var u=s*2;a.push(0+u,1+u,2+u),a.push(1+u,3+u,2+u)}e.setAttribute("position",new Ae(new Float32Array(r),3)),e.setAttribute("uv",new Ae(new Float32Array([1,1]),2)),e.setIndex(a),e.computeVertexNormals(),fe>1&&this.filter&&(t=Ee);var v=new V(e,t);v.position.y=Ge+f,v.osm=this,v.position.y>=1&&(v.castShadow=R),v.position.y>=1&&(v.receiveShadow=R),wi(v,this.wayNodes[0])};B.prototype.Subway=function(t,i,e=16){if(Ge>=0&&this.typeMain=="railway"){this.WaySC(o.black,2.2,X*1,!0),this.WaySC(o.grey,2,X*2);return}var r=[];for(var a in this.wayNodes){var s=H[this.wayNodes[a]],n=s.x,h=s.z;r.push(new Ei(n,0,h))}Ge==0&&this.GetTag("location")=="underground"&&(Ge=-4),fe>1&&this.filter&&(t=Ee);var l=new zn(r),f=new Cn(l,this.wayNodes.length*3,i,e,!1),d=new V(f,t);d.position.y=Ge+i/2+.2,d.osm=this,d.castShadow=!1,d.receiveShadow=!1;var u=Math.floor(this.wayNodes.length/2);pi(d,this.wayNodes[u])};B.prototype.WaySC=function(t,i,e,r,a){var s=[],n;for(var h in this.wayNodes){var l=H[this.wayNodes[h]];if(a&&(l.AddTag("natural",a),l.Place()),l.idWay==0||l.idWay==this.id){l.idWay=this.id;var f;if(f=l.GetTag("waterway")){l.typeMain="!";var d=this.AngleAtNode(h);f=="weir"&&new g().box(i*2,.4,1).roty(d).node(o.grey,l)}var u;if(u=l.GetTag("ford")){l.typeMain="!";var d=this.AngleAtNode(h);if(u=="stepping_stones"){var v=new g().box(i*.5,.4,1).trans(+i*.4,0,0);new g().box(i*.5,.4,1).trans(-i*.4,0,0).merge(v).roty(d).node(o.grey,l)}}var y;if((y=l.GetTag("railway"))&&y=="buffer_stop"){l.typeMain="!";var d=this.AngleAtNode(h);new g().cyl(3,3,4,3).rotz(90).roty(d+180).node(o.black,l)}var m;if(m=l.GetTag("barrier")){if(m=="gate"||m=="lift_gate"){l.typeMain="!";var d=this.AngleAtNode(h),w=1e-4;m=="gate"&&(w=.1);var M=new g().box(w,1,w).trans(+i-.1,.5,0),x=new g().box(.1,1,.1).trans(-i+.1,.5,0);new g().cyl(.05,.05,i*2).rotz(90).trans(0,1,0).merge(M).merge(x).roty(d).node(o.grey,l)}if(m=="cycle_barrier"||m=="cycle_barrier"){l.typeMain="!";var d=this.AngleAtNode(h),w=.05,b=new g().box(w,1,w).trans(+i,.5,.4),P=new g().box(w,1,w).trans(0,.5,.4),G=new g().box(w,1,w).trans(0,.5,-.4),S=new g().box(w,1,w).trans(-i,.5,-.4),E=new g().box(i+w,w,w).trans(+i/2,1,.4);new g().box(i+w,w,w).trans(-i/2,1,-.4).merge(b).merge(P).merge(G).merge(S).merge(E).roty(d).node(o.grey,l)}}var _;if((_=l.GetTag("traffic_calming"))&&(l.typeMain="!",_=="bump")){var d=this.AngleAtNode(h);new g().plane(i*2,.5).rotx(90).trans(0,.3,0).roty(d).node(o.yellow,l)}}var A=l.Highway(this.id,i,e);if(A!=null&&s.push(A),h>0){var O=this.RectangleGeometry(n.x,n.z,l.x,l.z,i,e);O&&s.push(O)}n=l}if(fe>1&&this.filter&&(t=Ee),s.length==0){at("merge1");return}var W=$i(s,!1),Y=new xe;Y.makeRotationX(k(90)),W.applyMatrix4(Y);var L=new V(W,t);L.position.y=Ge+e,L.osm=this,r?(L.castShadow=!1,L.receiveShadow=!1):(L.position.y>=1&&(L.castShadow=R),L.position.y>=-0&&(L.receiveShadow=R)),r?wi(L,this.wayNodes[0]):pi(L,this.wayNodes[0])};B.prototype.GetLL=function(t){var i=this.GetTag("level",!1,!0),e=this.GetTag("layer",!1,!0);return i?i.replace(",","."):e?e.replace(",","."):t==0?0:!1};B.prototype.Steps=function(){var t="",i="",e=H[this.wayNodes[0]],r=H[this.wayNodes[this.wayNodes.length-1]],s=e.GetLLm();if(s!=!1&&(t=s),t==""){var a=ue[e.idWay];if(a){var s=a.GetLL();s!=!1&&(t=s*te)}}var s=r.GetLLm();if(s!=!1&&(i=s),i==""){var a=ue[r.idWay];if(a){var s=a.GetLL();s!=!1&&(i=s*te)}}if(t==""&&i==""){var n=this.GetTag("incline",!1);n?n=n=="up"?1:-1:n=0;var s=this.GetLL();s==!1?s="0;"+n:s=s.toString();var h=s.split(";");if(h.length<2&&(at("steps without two level: "+this.id,this),n>0?h=[s*1,s*1-n*1]:h=[s*1,s*1+n*1],n=0),n<0)var t=h[1]*te,i=h[0]*te;else var t=h[0]*te,i=h[1]*te}t==""&&(t=0),i==""&&(i=0);var l=e.x,f=e.z,d=r.x,u=r.z,v=l-d,y=f-u,m=Math.atan2(v,y),w=dt(m,.7);if(v==0&&y==0){if(this.GetTag("area")!="no"){this.Shape(o.steps,t+X*6+1);return}return null}if(t==i){Ge=0,this.WaySC(o.steps,.7,t+X*6,!1);return}var M=new _t,x=[],b=[];x.push(l+w[1],t+X*6,f-w[0]),x.push(l-w[1],t+X*6,f+w[0]),x.push(d-w[1],i+X*6,u+w[0]),x.push(d+w[1],i+X*6,u-w[0]),b.push(0,1,2),b.push(0,2,3),M.setAttribute("position",new Ae(new Float32Array(x),3)),M.setAttribute("uv",new Ae(new Float32Array([1,1]),2)),M.setIndex(b),M.computeVertexNormals();var P;fe>1&&this.filter?P=Ee:P=o.steps;var G=new V(M,P);G.osm=this,G.position.y>=1&&(G.castShadow=R),G.position.y>=1&&(G.receiveShadow=R),pi(G,this.wayNodes[0])};B.prototype.RectangleGeometry=function(t,i,e,r,a,s){var n=t-e,h=i-r,l=Math.atan2(n,h),f=dt(l,a);if(n==0&&h==0)return ir("Two way-Nodes in line at the same place!!! "+this.id,this),null;var d=[];d.push(new ee(e-f[1],r+f[0])),d.push(new ee(e+f[1],r-f[0])),d.push(new ee(t+f[1],i-f[0])),d.push(new ee(t-f[1],i+f[0]));var u=new Ke(d),v=new Ha(u);return new xe,v};B.prototype.AnalyseWay=function(t){for(var i in this.wayNodes){this.id==467451045&&p("way AnalyseWay");var e=H[this.wayNodes[i]];e?e.AnalyseWay(this.id,t):ir("AnalyseWay: bäh! "+this.id,this)}};B.prototype.WayWidth=function(t){switch(t){case"motorway":case"trunk":case"primary":return 4;case"secondary":case"motorway_link":case"primary_link":case"trunk_link":case"road":return 3.5;case"raceway":case"secondary_link":case"tertiary":return 3;case"tertiary_link":case"residential":case"living_street":return 2.5;case"service":case"services":case"abandoned":case"pedestrian":case"unclassified":case"crossing":return 1.5;case"track":case"footway":case"cycleway":case"path":return 1;case"cemetery":return .25;default:return 0}};B.prototype.Info=function(){{if(qi=this.tags.slice(),ni=[],this.tags.length==0)return ni.push("- No tags -");this.Tag(this.typeMain),this.Tag("name"),this.Tag("description",0),this.Tag("area",-1);var t=!1;for(var i in this.tags)this.tags[i].indexOf("addr:")==0&&(t=!0);for(t&&(this.Tag("addr:housenumber",0),this.Tag("addr:housename",0),this.Tag("addr:street",2),this.Tag("addr:place",2),this.Tag("addr:postcode",0),this.Tag("addr:city",2),this.Tag("addr:country",2),this.Tag("addr:state",2),this.Tag("addr:suburb",0));qi.length>0;)this.Tag(qi[0]);return ni}};B.prototype.Tag=function(t,i){i==null&&(i=1);var e=!1;for(var r in this.tags)this.tags[r]==t&&(e=this.values[r]);e&&(i==0&&ni.push(e),i==1&&ni.push(t+":"+e),i==2&&(ni[ni.length-1]+=" "+e),qi.splice(qi.indexOf(t),1))};B.prototype.railway=function(t){switch(t){case"loading_ramp":case"platform":case"platform_edge":de(this,o.grey,X*3,.5);break;case"subway":this.Subway(o.grey1,te/2);break;case"narrow_gauge":var i=this.GetTag("gauge",1);i>3&&(i/=1e3),this.WaySC(o.grey1,i,X*2);break;case"construction":this.WaySC(o.landfill,2.2,X*2);break;case"abandoned":case"disused":this.WaySC(o.black1,2.2,X*1,!0),this.WaySC(o.green,2,X*2);break;case"razed":this.WaySC(o.blackT,2,X*2);break;case"funicular":this.WaySC(o.blue,2.2,X*1,!0),this.WaySC(o.grey1,2,X*2);break;case"rail":this.WaySC(o.black1,2.2,X*1,!0),this.WaySC(o.grey1,2,X*2);break;case"light_rail":this.WaySC(o.grey1,1.5,X*2);break;case"tram":this.WaySC(o.grey1,1,X*2);break;case"miniature":this.WaySC(o.grey1,.5,X*2);break;case"without_tags":T>5&&p("highway",t,this.id,this.tags,this.values);return;case"monorail":this.Subway(o.grey1,1,3);break;default:this.WaySC(o.red,1.5,X*2);break}};B.prototype.highway=function(t){if(this.id==217154992&&p("highway found"),t=="elevator"){this.Building(o.buildingIndoor);return}if(t=="steps"){this.Steps();return}if(t=="disused"){this.WaySC(o.grey,1.5,0,0);return}if(t=="bus_stop"){this.Shape(o.grey,0);return}if(t=="rest_area"){this.Shape(o.rest_area,0);return}if(t=="construction"){this.WaySC(o.construction,2,0);return}if(t=="proposed"){this.WaySC(o.yellow,2,0);return}if(t=="bridleway"){this.WaySC(o.green,1,0);return}if(t=="abandoned"){this.WaySC(o.black,1.5,0);return}if(t=="path")if(this.GetTag("bicycle")!="no"){ei(this,o.footway,X*2.5,1);return}else{ei(this,o.blue,X*2.5,1);return}if(t=="traffic_island"){this.Shape(o.grey,X*2);return}if(t=="platform"){de(this,o.grey,X*3,.5);return}if(t=="pedestrian"){ei(this,o.grey,X*2,.5);return}var i=this.WayWidth(t),e=i/4*X;if(i==0){this.WaySC(o.red,2,0),T>5&&p("highway",t,this.id,this.tags,this.values);return}var r=o.white1;switch(t){case"motorway_link":case"motorway":r=o.motorway;break;case"raceway":r=o.raceway;break;case"trunk_link":case"trunk":r=o.trunk;break;case"primary_link":case"primary":r=o.primary;break;case"secondary_link":case"secondary":case"tertiary_link":case"tertiary":r=o.secondary;break;case"track":r=o.track;break;case"footway":r=o.footway;break;case"cycleway":r=o.blue;break}if(t=="footway"){ei(this,o.footway,X*2.5,1);return}i>2.5&&ei(this,o.black,e+X*3,i*1.2),ei(this,r,e+X*4,i)};B.prototype.memorial=function(t){this.Building(o.pl_o_worship)};B.prototype.building=function(t){switch(t=="yes"&&(li=this.GetTag("amenity"))&&(t=li),t){case"church":case"cathedral":case"place_of_worship":this.Building(o.pl_o_worship);break;case"construction":this.Building(o.construction);break;case"no":this.typeMain=void 0;break;default:this.Building(o.building);break}};B.prototype.leisure=function(t){var i=.05,e=.05*4,r=.05*5,a=-.05*2;switch(t){case"forest":this.Shape(o.forest,a);break;case"industrial":this.Shape(o.industrial,a);break;case"landfill":this.Shape(o.landfill,a);break;case"park":this.Shape(o.park,a);break;case"sports_centre":case"golf_course":this.Shape(o.scrub,a);break;case"pitch":this.Shape(o.pitch,r);break;case"outdoor_seating":case"swimming_pool":case"water_park":case"stadium":case"fitness_station":case"playground":this.Shape(o.playground,e);break;case"track":de(this,o.track,i,3);break;case"garden":case"meadow":this.Shape(o.grass,a);break;case"marina":this.Shape(o.water,a);break;case"nature_reserve":break;default:this.Shape(o.amenity_brown,a),T>5&&p("leisure",t,this.id,this.tags,this.values);break}};B.prototype.natural=function(t){var i=.05,e=-.05*1,r=-.05*2,a=-.05*3;switch(t){case"sand":this.Shape(o.sand,i);break;case"wood":this.Shape(o.forest,e);break;case"mud":this.Shape(o.mud,e);break;case"beach":case"scrub":this.Shape(o.scrub,e);break;case"wetland":case"wetland_wet_meadow":case"wetland_marsh":case"grasland":this.Shape(o.grass,r);break;case"shingle":this.Shape(o.bare_ground,r);break;case"bay":case"spring":case"hot_spring":case"geyser":case"water":this.Shape(o.water,e);break;case"slope":case"coastline":de(this,o.sand,a,.75);break;case"heath":this.Shape(o.heath,r);break;case"scree":case"bare_rock":case"glacier":this.Shape(o.grey,e);break;case"grass":case"grassland":this.Shape(o.grass,r);break;case"tree_row":de(this,o.grass,r,.75,"tree");return;case"cliff":de(this,o.grey1,r,.75,"cliff");return;default:de(this,o.red,e,2);break}};function ei(t,i,e,r,a){t.wayNodes[0]==t.wayNodes[t.wayNodes.length-1]&&t.GetTag("area","no")!="no"?t.Shape(o.bright,e+.1*X):t.WaySC(i,r,e,void 0,a)}function de(t,i,e,r,a){t.wayNodes[0]==t.wayNodes[t.wayNodes.length-1]&&t.GetTag("junction")!="roundabout"?t.Shape(i,e-X*2):t.WaySC(i,r,e,void 0,a)}B.prototype.amenity=function(t){var i=.11499999999999999;switch(t){case"bench":de(this,o.yellow,.5,.5);break;case"restaurant":this.Shape(o.buildingPlus,i);break;case"fountain":this.Shape(o.waterB,i);break;case"sport":this.Shape(o.dblau,i);break;case"motorcycle_parking":case"bicycle_parking":case"parking":de(this,o.parking,i-X,1);break;case"garages":this.Shape(o.garages,i);break;case"university":this.Shape(o.school,-.05*7);break;case"college":case"kindergarten":case"school":this.Shape(o.school,i);break;case"place_of_worship":this.Shape(o.pl_o_worship,i);break;default:this.Shape(o.amenity_brown,i),T>5&&p("amenity",t,this.id,this.tags,this.values);break}};B.prototype.aeroway=function(t){var i=.30000000000000004,e=.05*5,r=-.05*7;switch(t){case"aerodrome":this.Shape(o.airprot,r);break;case"apron":this.Shape(o.apron,r);break;case"beacon":de(this,o.yellow,e,1.5);break;case"runway":de(this,o.aeroway,e,18),de(this,o.yellow,i,.5);break;case"taxilane":case"taxiway":de(this,o.aeroway,e,6),de(this,o.yellow,i,.5);break;case"stand":case"parking_position":de(this,o.yellow,i,.5);break;case"aerodrome traffic circuit":break;default:de(this,o.red,e,4),T>5&&p("aeroway",t,this.id,this.tags,this.values);break}};B.prototype.landuse=function(t){var i=-.30000000000000004,e=-.05*7;switch(t){case"residential":this.Shape(o.residential,i-X);break;case"port":case"industrial":this.Shape(o.industrial,i-X);break;case"highway":case"traffic_island":this.Shape(o.grey,X*2);break;case"landfill":this.Shape(o.landfill,i);break;case"education":case"university":case"school":this.Shape(o.school,i);break;case"allotments":this.Shape(o.allotments,i);break;case"raceway":case"yard":case"vineyard":case"orchard":this.Shape(o.orchard,i);break;case"cemetery":this.Shape(o.cemetery,i);break;case"commercial":this.Shape(o.commercial,i);break;case"farm":case"farmland":this.Shape(o.farmland,i);break;case"garages":this.Shape(o.garages,i);break;case"plant_nursery":case"orchad":case"greenfield":case"farmyard":this.Shape(o.farmyard,i);break;case"trees":case"wood":case"forest":this.Shape(o.forest,i);break;case"green":case"brownfield":case"railway":case"meadow":this.Shape(o.grass,i);break;case"winter_sports":this.Shape(o.residential,e);break;case"runway":this.Shape(o.aeroway,i);break;case"aerodrome":case"airport":this.Shape(o.airport,e);break;case"military":this.Shape(o.military,i);break;case"quarry":this.Shape(o.quarry,i);break;case"park":this.Shape(o.park,i);break;case"religious":this.Shape(o.pl_o_worship,i);break;case"retail":this.Shape(o.retail,i);break;case"civic_admin":case"civic":case"government":case"pedestrian":case"bare_rock":case"plaza":this.Shape(o.grey,i);break;case"churchyard":case"courtyard":case"recreation_ground":this.Shape(o.societal_am,i);break;case"village_green":case"garden":case"greenhouse_horticulture":case"grassland":case"grass":this.Shape(o.grass,i+X);break;case"pond":case"basin":case"reservoir":this.Shape(o.water,i+X);break;case"depot":case"construction":this.Shape(o.construction,i+X);break;case"civil":this.Shape(o.no_osm,i);break;case"harbour":break;case"mixed":this.Shape(o.yellow,i);break;default:this.Shape(o.red,i),T>5&&p("landuse",t,this.id,this.tags,this.values);break}};B.prototype.man_made=function(t){switch(t){case"embankment":de(this,o.black,0,.75,"cliff");return;case"obelisk":this.GetTag("height",!1,!0)||this.AddTag("height","15"),this.Building(o.grey);break;case"tower":this.GetTag("height",!1,!0)||this.AddTag("height","22"),this.Building(o.building);break;case"water_tower":this.GetTag("height",!1,!0)||this.AddTag("height","25"),this.Building(o.building);break;case"chimney":this.GetTag("height",!1,!0)||this.AddTag("height","60"),this.Building(o.industrial);break;case"campanile":this.Building(o.pl_o_worship);break;case"pumping_station":this.Building(o.industrial);break;case"wastewater_plant":case"works":this.Shape(o.industrial,3*X);break;case"breakwater":de(this,o.grey,0,1.44);break;case"pier":this.AddTag("levels","0.98"),this.AddTag("min_level","0.90"),this.Building(o.land);break;case"bridge":this.AddTag("levels","0.98"),this.AddTag("min_level","0.90"),this.Building(o.bridge);break;case"pipeline":this.Subway(o.red,.4,16);break;case"dyke":de(this,o.red,3,3);break;case"cutline":ei(this,o.grass,X*3,4);break;default:this.Building(o.red);break}};B.prototype.power=function(t){var i=-.2;switch(t){case"cable":this.PowerLine(o.grey,!1);break;case"abandoned_line":this.PowerLine(o.yellow,!0);break;case"line":case"minor_line":this.PowerLine(o.grey,!0);break;case"plant":case"generator":case"substation":this.Shape(o.industrial,i);break;default:this.Building(o.industrial);break}};B.prototype.room=function(t){var i=0;switch(t){case"restaurant":this.Shape(o.commercial,i,!0);break;case"yes":case"shop":this.Shape(o.industrial,i,!0);break;case"toilets":this.Shape(o.societal_am,i,!0);break;case"corridor":case"entrance":case"pedestrian":this.Shape(o.grey,i,!0);break;default:this.Shape(o.red,i,!0);break}};B.prototype.boundary=function(t){};B.prototype.interpolation=function(t){var i=te,e=new _t,r=[],a=[];for(var s in this.wayNodes){var n=H[this.wayNodes[s]],h=n.x,l=n.z,f=o.building;r.push(h,0,l,h,i,l)}for(var s=0;s<this.wayNodes.length-1;s++){var d=s*2;a.push(0+d,1+d,2+d),a.push(1+d,2+d,3+d)}e.setAttribute("position",new Ae(new Float32Array(r),3)),e.setAttribute("uv",new Ae(new Float32Array([1,1]),2)),e.setIndex(a),e.computeVertexNormals(),fe>1&&this.filter&&(f=Ee);var u=new V(e,f);u.position.y=Ge,u.osm=this,wi(u,this.wayNodes[0])};B.prototype.barrier=function(t){switch(t){case"jersey_barrier":de(this,o.grey,0,.75,"cliff");return;case"fence":this.Fence(o.yellow);break;case"railing":this.Fence(o.black,1.2);break;case"city_wall":case"wall":this.Fence(o.grey);break;case"kerb":this.Fence(o.grey,.3);break;case"guard_rail":this.Fence(o.grey,.6);break;case"bollard":this.Fence(o.blackT,.6);break;case"retaining_wall":de(this,o.land,0,.75,"cliff");return;case"hedge":this.GetTag("area")?(this.GetTag("height",!1,!0)||this.AddTag("height","1"),this.Building(o.green)):this.Fence(o.green);break;default:this.Fence(o.red);break}};B.prototype._keep=function(t){T>5&&p("_keep",t,this.id,this.tags,this.values)};B.prototype.waterway=function(t){switch(t){case"waterfall":case"drain":case"stream":this.WaySC(o.waterB,2,0);break;case"canal":this.WaySC(o.waterB,10,0);break;case"river":this.WaySC(o.waterB,4,0);break;case"riverbank":this.Shape(o.water,-.05);break;case"slipway":this.Shape(o.red,-.05);break;default:this.WaySC(o.waterB,2,0),T>5&&p("waterway",t,this.id,this.tags,this.values);break}};B.prototype.DoTag=function(t){{var i=t;if(i=="interpolation"&&(i="addr:interpolation"),this.typeMain)return;(li=this.GetTag(i))&&(Ge=hs(this),this.typeMain=t,this[t](li),Ge=0)}};B.prototype.Place=function(){{if(this.typeMain)return;if(this.id*1==Gt)p("Debug Way Place, ID: ",this.id,this);else if(Ut)return;if(this.tags.length<1)return;var t;if(t=this.GetTag("3dmr")){var i,e=0,r=0;for(var a in this.wayNodes){var s=H[this.wayNodes[a]];if(a==0){var i=new N(0,11,22);i.tileX=s.tileX,i.tileZ=s.tileZ,i.tags=this.tags,i.values=this.values;continue}e+=s.x,r+=s.z}if(e/=this.wayNodes.length-1,r/=this.wayNodes.length-1,i.x=e,i.z=r,is(i,t)){this.typeMain="3dmr",i.typeMain="3dmr";return}}this.DoTag("building");var n;(n=this.GetTag("building:part"))&&!this.typeMain&&fi>0&&(Ge=hs(this),this.building(n),this.typeMain="building:part"),this.DoTag("room"),this.DoTag("power"),this.DoTag("memorial"),this.DoTag("landuse"),this.DoTag("amenity"),this.DoTag("leisure"),this.DoTag("natural"),this.DoTag("waterway"),this.DoTag("highway"),this.DoTag("railway"),this.DoTag("aeroway"),this.DoTag("barrier"),this.DoTag("boundary"),this.DoTag("interpolation"),this.DoTag("man_made"),this.DoTag("_keep"),(!this.typeMain&&T>5||T>8)&&p("PLACE ",this.typeMain,this.id,this.tags,this.values)}};B.prototype.Analyse=function(){if(li=this.GetTag("highway")){var t=this.WayWidth(li);t>0&&this.AnalyseWay(t);return}if(li=this.GetTag("building")){this.AnalyseWay(0);return}if(this.GetTag("building:part"))for(var i in this.wayNodes){var e=H[this.wayNodes[i]];e&&e.AnalysePart(this.id)}};function hs(t){var i=t.GetTag("level",0,!0),e=t.GetTag("layer",0,!0);if(i){var r=i.split(";");r.length>1&&(i=r[1])}if(e){var a=e.split(";");a.length>1&&(i=a[1])}if(Math.abs(e*Qr)>Math.abs(i*te))var s=e*Qr;else var s=i*te;return isNaN(s)&&(p("llPos isNaN: "+t.id),s=0),s}var H=[];function _o(){H=[],Ea=0,Ai=0,sa=void 0,Ja=0}var Ea=0,Ai=0;function xn(t){Ai=t}var sa=void 0,Ja=0,Ui=!1,oi=!1;function N(t,i,e){if(t==246519847*100&&p("node:"+t),t==0&&(t=ja,fs()),H[t]){this.id=0;return}this.id=t,this.id=t,ve==2&&(this.lat=i,this.lon=e),this.tileX=qr(e,pe),this.tileY=Ur(i,pe),this.x=tt(e,i),this.z=it(i),this.deadEnd=!1,this.idWay=0,this.raWay=0,this.partWay=0,this.tags=[],this.values=[],this.typeMain=void 0,this.filter=fe>1,this.mesh=null,H[t]=this,Ea&&(Ea.next=this),Ea=this,sa||(sa=this),T>=5&&p("new Node ",this.id,this.x,this.z),me&&this.id.toString().indexOf(me)>=0&&(gt.push(this),this.filter=!1),Ja++}N.prototype.AddTag=function(t,i){if(this.tags===void 0){p("tags MIST!nt",this,t,i);return}this.tags.push(t),this.values.push(i),T>5&&p("Node:AddTag",this.tags.length,t+":"+i),me&&(t.indexOf(me)>=0||i.indexOf(me)>=0)&&(gt.push(this),this.filter=!1)};N.prototype.DeadEnd=function(){this.deadEnd=!0};N.prototype.AnalyseWay=function(t,i){this.idWay==0&&(this.idWay=t)};N.prototype.AnalysePart=function(t){this.GetTag("shop")||(this.partWay=t)};N.prototype.Highway=function(t,i,e){if(this.raWay<i&&(this.idWay=t,this.raWay>0&&re.remove(this.mesh)),this.idWay!=t||this.deadEnd&&No)return null;this.GetTag("highway")=="turning_circle"&&(i*=2,this.typeMain="turning_circle"),this.raWay=i;var r=new Ln(i,16),a=new xe().makeTranslation(this.x,this.z,0);return r.applyMatrix4(a),r};N.prototype.GetTagNumber=function(t,i){for(var e in this.tags)if(this.tags[e]==t){var r=this.values[e],a=!(i&&isNaN(r*1));if(a)return r*1;var s=r.split(" ");return s.length>1&&s[1]=="m"&&(r=s[0],!isNaN(r*1))?r*1:(p("Real-Value ("+r+") NaN? nodeid "+this.id),!1)}return!1};N.prototype.GetTagDef=function(t,i){for(var e in this.tags)if(this.tags[e]==t)return this.values[e];return i};N.prototype.GetTag=function(t,i,e){for(var r in this.tags)if(this.tags[r]==t){var a=this.values[r],s=!(e&&isNaN(a*1));if(s)return a;if(p("Real-Value ("+a+") NaN? nodeid "+this.id),!i)return!1}return i||!1};N.prototype.GetTagStarts=function(t){for(var i in this.tags)return this.tags[i].indexOf(t)==0?this.values[i]:!1};N.prototype.Tag=function(t,i){i==null&&(i=1);var e=!1;for(var r in this.tags)this.tags[r]==t&&(e=this.values[r]);e&&(i==0&&oi.push(e),i==1&&oi.push(t+":"+e),i==2&&(oi[oi.length-1]+=" "+e),Ui.splice(Ui.indexOf(t),1))};N.prototype.GetLLm=function(){var t=this.GetTag("level");if(t){var i=t.split(";");i.length>1&&(t=i[i.length-1]);var i=t.split(",");i.length>1&&(t=i[i.length-1])}var e=this.GetTag("layer");if(e){var r=e.split(";");r.length>1&&(t=r[r.length-1]);var r=e.split(",");r.length>1&&(t=r[r.length-1])}var a=this.GetTag("min_height"),s=this.GetTag("building:min_height");return a?this.checkNaN(a)*1:s?this.checkNaN(s)*1:t?this.checkNaN(t)*te:e?this.checkNaN(e)*Qr:0};N.prototype.checkNaN=function(t){return!isNaN(t)||(p("Node NaN! id:"+this.id),t.replace(",","."),!isNaN(t))?t:0};N.prototype.Info=function(){{if(Ui=this.tags.slice(),oi=[],this.tags.length==0)return oi.push("- No tags -");this.Tag(this.typeMain),this.Tag("name"),this.Tag("description",0),this.Tag("area",-1);var t=!1;for(var i in this.tags)this.tags[i].indexOf("addr:")==0&&(t=!0);for(t&&(this.Tag("addr:housename",0),this.Tag("addr:housenumber",0),this.Tag("addr:street",2),this.Tag("addr:place",2),this.Tag("addr:postcode",0),this.Tag("addr:city",2),this.Tag("addr:country",2),this.Tag("addr:state",2),this.Tag("addr:suburb",0));Ui.length>0;)this.Tag(Ui[0]);return oi}};N.prototype.Entrance=function(t){this.typeMain||(this.typeMain="++placed++",new g().box(.04,2.1,1.4).trans(0,2.1/2,-.04/2).roty(t).node(o.yellow,this))};function Ao(t){if(!(Math.abs(t.x)>1e3)&&!(Math.abs(t.z)>1e3)){var i=99999,e=void 0;for(var r in H){var a=H[r];if(a.idWay&&ue[a.idWay]&&ue[a.idWay].GetTag("building")){var s=Math.abs(t.x-a.x)+Math.abs(t.z-a.z);i>s&&(i=s,e=a)}}if(e){var n=ue[e.idWay];n.mesh&&(n.mesh.material=o.yellow)}}}N.prototype.Place=function(t){if(!this.typeMain){if(this.typeMain="+placed+",this.id*1==Gt)p("Debug Node Place, ID: ",this.id,this);else if(Ut)return;if(this.GetTag("GO-Note")){if(ve==2&&Math.abs(this.x)<1e3&&Math.abs(this.z)<1e3){var i=2,e=1.6,r=14,a=new g().box(e,i,.001).trans(e/2,r-i/2,0);return new g().cyl(.08,.08,r).trans(0,r/2,0).merge(a).node(o.yellow,this)}return new g().sph(.6).try2(.6).node(o.yellow,this)}if(ve!=2){var s;if((s=this.GetTag("3dmr"))&&is(this,s)){p("addRepo ttt"),this.typeMain="3dmr";return}var n=this.GetTag("public_transport"),h=this.GetTag("leisure"),l=this.GetTag("natural"),f=this.GetTag("barrier"),d=this.GetTag("power"),u=this.GetTag("railway"),v=this.GetTag("highway"),y=this.GetTag("amenity"),m=this.GetLLm();if(this.GetTagStarts("information")=="guidepost"){var a=new g().box(1,.2,.001).trans(0,1.9,0);return new g().cyl(.04,.04,2).try2(2).merge(a).node(o.white,this)}if(this.GetTagStarts("man_made")=="flagpole"){var a=new g().box(1,2,.001).trans(.5,9,0);return new g().cyl(.08,.08,10).trans(0,5,0).merge(a).node(o.grey,this)}if(this.GetTagStarts("man_made")=="surveillance"){var a=new g().sph(.2).trans(0,2.8,0);return new g().box(.05,2.8,.05).trans(0,2.8/2,0).merge(a).node(o.red,this)}if(this.GetTagStarts("man_made")=="chimney")return new g().cyl(1.5,2,30).trans(0,30/2,0).node(o.industrial,this);if(this.GetTagStarts("man_made")=="mast")return new g().cyl(.25,.25,20).trans(0,20/2,0).node(o.black,this);if(v=="bus_stop"||n=="platform"){var a=new g().sph(.2).trans(0,2,0);return new g().box(.05,2,.05).trans(0,2/2,0).merge(a).node(o.yellow,this)}if(this.GetTag("historic")=="memorial"&&this.GetTag("memorial:type")=="stolperstein")return new g().plane(.3,.3).rotx(90).trans(0,X*6,0).node(o.red,this);if(this.GetTag("historic")=="wayside_cross"){var a=new g().box(1.5,.2,.2).trans(0,1.5,0);return new g().box(.2,2,.2).trans(0,2/2,0).merge(a).node(o.grey,this)}if(this.GetTag("sport")=="gymnastics"){var w=new g().box(.1,2,.1).trans(.7,1,0),M=new g().box(.1,2,.1).trans(-.7,1,0),s=new g().box(1.4,.1,.1).trans(0,1.2,0);return new g().box(1.4,.1,.1).trans(0,1.9,0).merge(w).merge(M).merge(s).node(o.red,this)}if(y)switch(y){case"bench":var x=this.GetTag("direction",0,!0)*1,w=new g().box(.1,.5,.6).trans(.6,.25,0),M=new g().box(.1,.5,.6).trans(-.6,.25,0),b=new g().box(1.5,.1,.6).trans(0,.5,0).merge(w).merge(M);if(this.GetTag("backrest")!="no")var b=new g().box(1.5,.6,.05).rotx(10).trans(0,.5+.6/2,.6/2+.05).merge(b);return b.roty(-x).node(o.yellow,this);case"grit_bin":return new g().box(1,.8,.8).try2(.8).node(o.grey,this);case"waste_basket":return new g().cyl(.25,.2,.6,4).try2(.6).node(o.grey,this);case"vending_machine":return new g().box(1,1.8,.3).try2(1.8).node(o.yellow,this);case"atm":return new g().box(1,1.8,.3).try2(1.8).node(o.green,this);case"clock":var a=new g().cyl(.4,.4,.3).rotz(90).trans(0,1.6+.4/2,0);return new g().box(.2,1.6,.2).try2(1.6).merge(a).node(o.yellow,this);case"table":return this.renderTable(o.red);case"telephone":return new g().box(.8,2,.8).try2(2).node(o.blue,this);case"post_box":return new g().box(.6,1.2,.4).try2(1.2).node(o.blue,this);case"parking":case"bicycle_parking":case"motorcycle_parking":return new g().plane(2,2).rotx(90).trans(0,X*6,0).node(o.parking,this);case"recycling":var a=new g().sph(.6).trans(0,1,0);return new g().cyl(.6,.6,1).try2(1).merge(a).node(o.yellow,this);case"fountain":var a=new g().cyl(.1,.05,1.5).trans(0,.75,0);return new g().cyl(1,1,.3).trans(0,.15,0).merge(a).node(o.blue,this);case"public_bookcase":return new g().box(.4,1.8,1).try2(1.8).node(o.white,this);case"taxi":return new g().box(.6,.6,.6).rotx(45).rotz(45).trans(0,1.5,0).node(o.yellow,this);case"drinking_water":return new g().cyl(.2,.2,.8).try2(.8).node(o.blue,this);case"toilets":return new g().box(1,2,1).try2(2).node(o.amenity_brown,this)}if(this.GetTag("tourism")=="artwork"){var P=new g().box(1,1,.2).try2(1),G=new g().box(.2,1,1).try2(1);return new g().box(1,.2,1).try2(1).merge(P).merge(G).node(o.grey,this)}if(this.GetTag("information")=="board"||this.GetTag("tourism")=="information")return new g().box(.05,2,1).try2(1).node(o.white,this);if(this.GetTag("advertising")=="column")return new g().cyl(.7,.7,3).try2(3).node(o.yellow,this);if(this.GetTag("highway")=="motorway_junction"){var S="Exit ",E=this.GetTag("ref"),_=this.GetTag("name");if(E&&(S+=E),_&&(S+=": "+_),S=="Exit ")return;var A=40,O=document.createElement("canvas");O.width=1024,O.height=1024/8;var W=O.getContext("2d");W.font="Bold "+A+"px Arial";var Y=W.measureText(S).width,L="Bold ";W.fillStyle="rgba(0,0,0,0.00)",W.fillRect(0,0,Y+6,A+6),W.fillStyle="rgba(232,146,162,0.8)",W.font=L+A+"px Arial",W.fillText(S,0,A);var Z=new Pa(O);Z.needsUpdate=!0;var ne=5,De=new ks({map:Z,color:16777215}),K=new Ss(De);K.position.set(this.x,40,this.z),K.scale.set(O.width/ne,O.height/ne,1),re.add(K),this.typeMain="label";return}var ie=this.GetTag("place");if(ie){var I=6;switch(ie){case"municipality":I=14;break;case"city":I=12;break;case"town":I=11;break;case"borough":case"village":case"suburb":case"neighbourhood":I=9;break;case"quarter":case"city_block":case"hamlet":case"isolated_dwelling":case"square":case"plot":I=8;break;case"farm":case"allotment":case"allotments":case"locality":I=7;break}var S=this.GetTag("name");if(!S)return;var i=50+I*2;qt&&(i=F.position.y),i<50&&(i=50);var A=5.2*I,O=document.createElement("canvas");O.width=1024,O.height=1024/8;var W=O.getContext("2d");W.font="Bold "+A+"px Arial";var Y=W.measureText(S).width,L="Bold ";I<=6&&(L="Italic "),W.fillStyle="rgba(0,0,0,0.00)",W.fillRect(0,0,Y+6,A+6),W.fillStyle="rgba(255,255,"+I*2+",0.8)",I<=6&&(W.fillStyle="rgba(255,0,0,0.8)"),W.font=L+A+"px Arial",W.fillText(S,0,A),I>=10&&W.fillRect(0,A*1.2,Y,A/10);var Z=new Pa(O);Z.needsUpdate=!0;var ne=5;qt&&(ne=2);var De=new ks({map:Z,color:16777215}),K=new Ss(De);K.position.set(this.x,i,this.z),K.scale.set(O.width/ne,O.height/ne,1),re.add(K),this.typeMain="label";return}if(this.GetTag("addr:postcode")&&this.tags.length==1||this.GetTag("uk_postcode_centroid"))return new g().cyl(6,0,2).trans(0,90,0).node(o.red,this,!1,!1);if(this.GetTag("communication:mobile_phone")){var a=new g().cyl(.7,.7,3,3).trans(0,21.5,0);return new g().box(.2,20,.2).try2(20).merge(a).node(o.blue,this)}if(this.GetTagStarts("traffic_sign")){var a=new g().box(.7,.7,.01,8).rotx(0).trans(0,2.35,0);return new g().box(.07,2,.07).try2(2).merge(a).node(o.yellow,this)}if(v)switch(v){case"street_lamp":var I=this.GetTagDef("height",2.6)*1/2.6,a=new g().cyl(.15*I,.15*I,.4*I).trans(0,2.2*I,0);return new g().cyl(.03*I,.03*I,2*I).trans(0,1*I,0).merge(a).node(o.grey,this);case"stop":var a=new g().cyl(.8,.8,.01,8).rotx(90).rotz(360/16).trans(0,2.4,0);return new g().cyl(.04,.04,2).trans(0,1,0).merge(a).node(o.red,this);case"give_way":var a=new g().cyl(.8,.8,.01,3).rotx(90).rotz(360/1).trans(0,2.4,0);return new g().cyl(.04,.04,2).try2(2).merge(a).node(o.white,this);case"crossing":if(this.GetTag("crossing")=="island")return new g().cyl(1.4,1.8,.5).trans(0,.3,0).node(o.grey,this);if(this.GetTag("crossing_ref")=="zebra"||this.GetTag("crossing")=="zebra"){if(this.idWay==0)var ce=0;else var ge=ue[this.idWay],ce=ge.AngleAtNode(ge.wayNodes.indexOf(this.id));return new g().plane(this.raWay*2,2).rotx(90).roty(ce).trans(0,.3,0).node(o.grey,this,R,!1)}return}var Ot=this.GetTag("cycleway");if(Ot&&Ot=="asl"){if(this.idWay==0)var ce=0;else var ge=ue[this.idWay],ce=ge.AngleAtNode(ge.wayNodes.indexOf(this.id));return new g().plane(1,2).rotx(90).roty(ce).trans(0,.3,0).node(o.green,this,R,!1)}if(v=="traffic_signals"||this.GetTag("crossing")=="traffic_signals"){var I=.4;new g().box(I,I,I).trans(0,2.34+I+I,0).node(o.red,this),new g().box(I,I,I).trans(0,2.32+I,0).node(o.yellow,this),new g().box(I,I,I).trans(0,2.3,0).node(o.green,this);return}if(this.GetTag("emergency")=="fire_hydrant"){var a=new g().cyl(.12,.12,.15).trans(0,.75,0);return new g().cyl(.08,.08,.9).trans(0,.45,0).merge(a).node(o.red,this)}if(this.GetTag("emergency")=="phone")return new g().box(.4,1.8,.3).try2(1.8).node(o.red,this);if(u=="signal"){var a=new g().box(.12,.5,.03).rotz(30).trans(0,2,0);return new g().box(.08,2,.08).try2(2).merge(a).node(o.black,this)}if(u=="milestone")return new g().plane(.5,.5).rotx(90).trans(0,.2,0).node(o.white,this);if(u=="subway_entrance"){if(this.idWay==0)var ce=0;else var ge=ue[this.idWay],ce=ge.AngleAtNode(ge.wayNodes.indexOf(this.id));return new g().box(1.8,1.2,5).trans(0,0,-2).roty(ce).node(o.yellow,this)}if(f=="kerb"){if(this.idWay==0)var ce=0;else var ge=ue[this.idWay],ce=ge.AngleAtNode(ge.wayNodes.indexOf(this.id));return new g().plane(this.raWay*2,2).rotx(90).roty(ce).trans(0,.3,0).node(o.grey,this,R,!1)}if(f=="bollard")return new g().cyl(.08,.08,1.2,8).trans(0,1.2/2+m*te,0).node(o.black,this);if(f=="barrier")return new g().cyl(.08,.08,1.2,8).trans(0,1.2/2+m*te,0).node(o.black,this);if(l=="tree"){o.green;var Ft=this.GetTag("type"),rt=this.GetTag("leaf_type"),q=this.GetTag("taxon:family"),Ne=this.GetTag("crown_type"),Me=this.GetTagDef("species",Sn);if(!Me)var Me="";if(Me.indexOf("Coniferous")>=0||Me.indexOf("Pinus")>=0||Me.indexOf("Occidentalis")>=0){var se=this.GetTag("height",9)/9,a=new g().cyl(0,2,8).trans(0,8/2+1,0);return new g().cyl(.2,.3,1).trans(0,1/2,0).merge(a,1).scale(se).node(o.green,this)}else if(Me.indexOf("palm")>=0||Ft=="palm"||rt=="palm"||q=="Arecaceae"||Ne=="I"){var se=this.GetTag("height",5)/5,ct=[];ct.unshift(new ee(0,0)),ct.unshift(new ee(.25,.5)),ct.unshift(new ee(0,1)),ct.unshift(new ee(-.25,.5));var i=2,Et=115,va=new g().shape(ct).rotx(Et).scale(se),c=new g().shape(ct).rotx(Et).roty(120).scale(se),e=new g().shape(ct).rotx(Et).roty(-120).scale(se).merge(va).merge(c).trans(0,i,0).node(o.green,this);new g().cyl(.04,.07,i).trans(0,i/2,0).scale(se,se,se).node(o.amenity_brown,this);return}else{var se=this.GetTag("height",5)/5;new g().sph(1.5).trans(0,2+1.5-.1,0).scale(se).node(o.green,this),new g().cyl(.2,.3,2).trans(0,2/2,0).scale(se/1.3,se,se/1.3).node(o.amenity_brown,this);return}}if(l=="cliff")return new g().cyl(0,1,1,5).node(o.grey,this);if(d=="generator"){if(this.GetTag("generator:source")!="wind")return;T>2&&p("########### windrad",this.id),this.typeMain="power",this.renderWindrad();return}if(this.GetTagStarts("seamark"))return new g().cyl(0,.5,1).try2(0,1,0).node(o.blue,this);if(h=="picnic_table"){T>2&&p("########### picnic_table"),this.typeMain="leisure",this.renderCamping(o.yellow);return}if(h=="playground"){var C=new g().box(.8,.8,.8).trans(-.1,3.6,0),ye=new g().box(.8,.8,.8).trans(0,.8*3+.4,-.1),Vt=new g().box(.8,.8,.8).trans(.1,.8*2+.4,0),bt=new g().box(.8,.8,.8).trans(0,.8*1+.4,.1);return new g().box(.8,.8,.8).trans(0,.8*0+.4,0).merge(C).merge(ye).merge(Vt).merge(bt).node(o.red,this)}if(!(this.tags.length==3&&this.tags[0]=="description"&&this.tags[1]=="layer"&&this.tags[2]=="level")&&!(this.tags.length==2&&(this.tags[0]=="layer"&&this.tags[1]=="level"||this.tags[0]=="description"&&this.tags[1]=="level"))&&!(this.tags.length==1&&(this.tags[0]=="level"||this.tags[0]=="layer"||this.tags[0]=="source"||this.tags[0]=="noexit"||this.tags[0]=="created_by"||this.tags[0]=="wheelchair"||this.tags[0]=="highway"&&this.values[0]=="crossing"||this.tags[0]=="power"&&this.values[0]=="pole"||this.tags[0]=="fixme"&&on==0))&&!(on==0&&(this.GetTagStarts("xmas:")||this.GetTagStarts("disused:")||this.GetTagStarts("TMC:cid_")||u=="switch"||u=="crossing"||u=="level_crossing"||u=="railway_crossing"||this.GetTag("removed:historic")||y=="marketplace"||n=="stop_position"))&&this.tags.length>0){var Ht=o.red,Dt=.4;return this.tags.length==1&&this.tags[0]=="addr:housenumber"&&(Ht=o.building,Dt=.8),(y=="pub"||y=="cafe"||y=="doctors"||y=="fast_food"||y=="ice_cream"||y=="restaurant"||y=="car_rental"||y=="car_sharing"||y=="bicycle_rental"||y=="bicycle_repair_station"||this.GetTag("shop"))&&(Ht=o.blue,Dt=.8),fe>1&&this.filter&&(Ht=Ee),new g().cyl(Dt,Dt,Dt*2,8).trans(0,1,0).node(Ht,this)}}}};N.prototype.renderCamping=function(t){var i=this.GetTagDef("height",.75)*1,e=this.GetTagDef("width",i*1.2)*1,r=this.GetTagDef("length",e*1.5)*1,a=this.GetTagDef("direction",0)*1,s=i/1.7,n;(n=this.GetTag("colour"))&&(t=Ia(n));var h=i/15,l=r/2.4-h,f=e/2-h,d=h*1.6,u=new g().box(e,h,r).trans(0,i-h/2,0);u.geometry,new g().box(d*1.5,i*1.1,d).rotz(35).trans(+f,i/2+.001,+l).mergeto(u),new g().box(d*1.5,i*1.1,d).rotz(35).trans(+f,i/2+.001,-l).mergeto(u),new g().box(d*1.5,i*1.1,d).rotz(-35).trans(-f,i/2+.001,+l).mergeto(u),new g().box(d*1.5,i*1.1,d).rotz(-35).trans(-f,i/2+.001,-l).mergeto(u),new g().box(e/3,i/15,r).trans(+e*.9,s,0).mergeto(u),new g().box(e/3,i/15,r).trans(-e*.9,s,0).mergeto(u),new g().box(e*2.1,d*1.1,i/15).trans(0,s-d/2,+l).mergeto(u),new g().box(e*2.1,d*1.1,i/15).trans(0,s-d/2,-l).mergeto(u),u.roty(a).node(t,this,R,R)};N.prototype.renderTable=function(t){var i=this.GetTagDef("seats",4),e=this.GetTagDef("height",.75)*1,r=this.GetTagDef("width",e*1.2)*1,a=this.GetTagDef("length",(i+1)/2*e/1.25),s=this.GetTagDef("direction",Math.PI)*1,n=e/1.5,h;(h=this.GetTag("colour"))&&(t=Ia(h)),t=[t,t,t,t,t,t];var l=e/15,f=a/2-l,d=r/2-l,u=l*1.6,v=[];v.push([+f,+d]),v.push([+f,-d]),v.push([-f,-d]),v.push([-f,+d]);var y=new g().box(r,e/15,a).trans(0,e-l/20,0);y.geometry;for(var m in v)new g().box(u,e,u).trans(v[m][1],e/2+.001,v[m][0]).mergeto(y);var w=Math.floor(i/2),M=Math.floor((i+1)/2);this.renderSeatSide(y,+r/2+n/2.5,a,w,n),this.renderSeatSide(y,-r/2-n/2.5,a,M,n),y.roty(s).node(t,this,R,R)};N.prototype.renderSeatSide=function(t,i,e,r,a){for(var s=a/1.25,n=a/1.25,h=0;h<r;h++){var l=e/r*((r-1)/2-h),f=n*.45,d=s*.45,u=[];u.push([+f,+d]),u.push([+f,-d]),u.push([-f,-d]),u.push([-f,+d]),new xe;var v=new g().box(n,a*.06,s).trans(0,a-a*.06/2,0);new g().box(n/10,a,s).trans(i/3.5,a+a/2,0).mergeto(v);for(var y in u)new g().box(n/10,a,s/10).trans(u[y][1],a/2+.001,u[y][0]).mergeto(v);v.trans(i,0,l).mergeto(t)}};N.prototype.renderWindrad=function(){try{var t=this.GetTagDef("min_height",0)*1,i=this.GetTagDef("height",100)*1-t,e=this.GetTagDef("width",i/20)/2,r=e/2,a=i*.05,s=i*.1,n=this.GetTagDef("rotor:diameter",i/2)*1}catch{p("renderSeatSide: unit not processed?");return}var h=new g().box(a,a,s).trans(0,i,s/2-r*2),l=new g().cyl(r,e,i).trans(0,i/2,0).merge(h).maps(o.industrial,this.x,this.z,0,R,R);l.position.y=t;var f=[];f.unshift(new ee(0,+a/2)),f.unshift(new ee(-n,0)),f.unshift(new ee(0,-a/2));var d=Math.random()*120,u=new g().shape(f).rotx(20).rotz(d+120),v=new g().shape(f).rotx(20).rotz(d-120),y=new g().shape(f).rotx(20).rotz(d).merge(u).merge(v).trans(0,0,-r*3).maps(o.industrial,0,0,i,R,R);l.add(y),l.osm=y.osm=this,jr.push(y),this.mesh=l};var le=null,pr="rgba(255,255,0,0.5)",vr=26,ke=null,Re=null,he="",ba=null;function Go(t,i){var e=new Bt({side:Qe}),y=new St(.3,.3,1,1);le=new V(y),le.name="logo",le.position.z=-1/2,le.position.y=.35,i&&i.add(le);var r=new fa;/*!*/r.load("models/osmlogo.png",function(b){T>2&&p("done: mLogo TextureLoader"),e.map=b,le.material=e,le.material.transparent=!0},function(b){T>2&&p(b.loaded/b.total*100+"% loaded mLogo TextureLoader")},function(b){p("An error happened for mLogo TextureLoader")});var a=document.createElement("canvas");a.width=256,a.height=a.width/2;var s=a.getContext("2d");s.fillStyle="rgba(0,0,0,0.2)",s.fillRect(0,0,a.width,a.height),s.font="Bold 31px Arial",s.fillStyle=pr;for(var n=0;n<5;n++){var h="WSENW".substr(n,1),l=s.measureText(h).width,f=s.measureText("'").width;s.fillText(h,a.width/4*n-l/2,a.height/2+10),s.fillText("'",a.width/4/3*(n*3+1)-f/2,a.height/2+10),s.fillText("'",a.width/4/3*(n*3+2)-f/2,a.height/2+10)}var d=new Pa(a);d.wrapS=In,d.needsUpdate=!0;var u=new Bt({map:d,side:_s});u.transparent=!0;var v=.1,y=new Za(v,32,32),m=new V(y,u);m.position.z=-1,Fi&&Fi.add(m),this.mCompass=m,this.canvas=document.createElement("canvas"),this.canvas.width=1024,this.canvas.height=this.canvas.width,this.context=this.canvas.getContext("2d"),this.context.font="Bold "+vr+"px Arial",this.texture=new Pa(this.canvas);var w=new Bt({map:this.texture});w.transparent=!0;var M=1;this.mHUD=new V(new St(M,M),w),this.mHUD.name="hud",i&&i.add(this.mHUD),this.dbgOn=$("hud",0),this.dFps=this.gFps=this.xFps=25,this.fpsA=[0,1,2,3,4,5,6,7,8,9],this.fpsMin=$("fps",10)*1,this.fpsSec=0;var x=new ut({color:0,side:_s});this.mHoe=new V(new St(.006,2.3),x),this.mHoe.name="höhe",this.mHoe.position.x=we.right*.998,this.mHoe.position.y=we.top*1,i&&i.add(this.mHoe),ke=null,Re=null,he="",ba=null,this.Resize=function(){this.mHUD.position.y=+we.top-.5,this.mHUD.position.x=-we.right+M/2,this.mCompass.position.x=we.right*.98-v,this.mCompass.position.y=we.top*.98-v},this.Update=function(b,P,G){{this.mCompass.rotation.y=G+k(180),this.mCompass.rotation.x=-F.rotation.x;var S=1/b;S>99&&(S=99),this.gFps=(this.gFps*6+S)/7,this.xFps=(this.xFps*99+S)/100;var E=.05;if(this.dFps+=b,this.dFps<E)return;this.dFps-=E;var _=Math.abs(this.gFps-this.fpsMin);_=_*_*_/1e3*b+1;var A=F.far;if(this.gFps<this.fpsMin?A/=_:A*=_,A>Kr&&(A=Kr),F.far=A,this.mHoe.scale.y=1.25-Math.log10(F.position.y)/2.5,this.fpsSec+=b,this.fpsSec>.5)this.fpsSec-=.5;else return;var O=Math.abs(F.position.y);O<1&&(O=1);var W=O=Math.sqrt(O);if(F.near=W/5,this.dbgOn>0){var Y=Fe+"n "+Math.floor(P)+"s "+Math.floor(j.heading)+"°  lat:"+Ze,L="dt:"+Math.floor(b*1e3)+" fps: "+Math.floor(S)+"/"+Math.floor(0+S)+"  "+ +we.right.toFixed(2)+"/"+ +we.top.toFixed(2)+"/"+F.aspect.toFixed(2),Z=Ba+" "+F.Lat().toFixed(4)+"/"+F.Lon().toFixed(4);this.Out([Y,L,Z])}}},this.Height=function(b){{if(!he)return;he.scale.y*=1+b}},this.Fps=function(){if(this.gFps<this.fpsMin){var b=this.canvas.width-99,P=10;this.context.clearRect(b,P,60,28),this.context.fillStyle="rgba(0,0,0,0.1)",this.context.fillRect(b,P,60,28),this.context.fillStyle=pr,this.context.fillText(Math.floor(this.gFps),b+33,P+21);for(var G=0;G<9;G++)this.fpsA[G]=this.fpsA[G+1],this.context.fillRect(b+3+G*3,P+22,3,-this.fpsA[G+1]);this.fpsA[9]=Math.sqrt(Math.floor(this.gFps))*2,this.texture.needsUpdate=!0}},this.Check=function(b,P,G){{var S=new ee(b,P);en.setFromCamera(S,F);var E=en.intersectObjects(t.children,!0);if(E.length>0&&E[0].object.osm!==he){if(E[0].distance>2&&G)return;if(ve==2){var _=E[0].object.osm;if(!_)return;var A;if(A=_.GetTag("GO-Note")){parent.house_clicked(A);return}if(A=_.GetTag("building")){var O=H[_.wayNodes[0]];parent.building_clicked(O.lat,O.lon);return}return}this.dbgOn=0,Re=E[0].object,he&&(he.material=ba),he=Re,ba=Re.material,ke=null,Ar(null),Re.osm?ke=Re.osm:Re.parent.osm?ke=Re.parent.osm:Re.parent.parent&&Re.parent.parent.osm&&(ke=Re.parent.parent.osm),ke&&(ke.typeMain=="3dmr"&&(p("3dmr selected"),Ar(Re.parent.parent)),he.osm=ke,ke.idWay&&!(ke.tags.length>0)&&(ke=ue[ke.idWay]),ke=ke.Info())}else{if(G)return;he&&(he.material=ba),he="",ke=null,Ar(null)}ke?(p("infoSelect: ",ke.toString()),Re.material=o.hgruen,this.Out(ke)):this.Out()}},this.Out=function(b){{if(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),b){for(var P=b.length,G=0,S=0;S<P;S++){var E=this.context.measureText(b[S]).width;G<E&&(G=E)}var _=3,A=3;this.context.fillStyle="rgba(0,0,0,0.15)",this.context.fillRect(_,A,G+_+_,P*(vr*5/4)+8),this.context.fillStyle=pr;for(var S=0;S<P;S++)this.context.fillText(b[S],_+3,A+vr*5/4*(S+1))}this.texture.needsUpdate=!0}},this.Point=function(b,P){if(P<50){if(b>window.innerWidth/3){window.open(be+"osmgo.org/info","_blank"),p("Point-Start beim Kompas");return}else if(Re){if(p("OSM:",he.osm),he.osm&&he.osm.typeMain&&he.osm.typeMain=="_keep"){var G=he.osm.GetTag("_keep"),S=he.osm.GetTag("K.R.  ID"),E=he.osm.GetTag("Keepright"),_=he.osm.GetTag("OSM ID");E=="way"&&window.open(be+"www.openstreetmap.org/way/"+_,"_blank"),E=="node"&&window.open(be+"www.openstreetmap.org/node/"+_,"_blank"),E=="relation"&&window.open(be+"www.openstreetmap.org/relation/"+_,"_blank"),window.open(be+"keepright.at/report_map.php?schema="+G+"&error="+S,"_blank");return}if(!he.osm)return;var A=!1;he.osm.wayNodes&&(A=!0),A?window.open(be+"www.openstreetmap.org/way/"+he.osm.id,"_blank"):window.open(be+"www.openstreetmap.org/node/"+he.osm.id,"_blank");return}}var O=b/window.innerWidth*2-1,W=-(P/window.innerHeight)*2+1;this.Check(O,W,!1)},this.DbgOn=function(b){this.dbgOn+=b,b==0&&(this.dbgOn>0?this.dbgOn=0:this.dbgOn=1)},this.Resize()}var re=new Va;re.name="Root:maps";var zs="",ti="",Lt="",ii="",Vi="OSM/go global chat",Oe=-1;function Hi(t){Oe=t}var Mn="NOT_PRESENT",Cs=void 0,Ls,Qr=3,te=3,xa=0,fi=1,fe=0,me="",gt=[],Ee=null,Is=0,gr=0,Rs=0,yr=0,wr=0,mr=0,Xs=0,br=0,Jt=0,xr=0,Bs=0,Mr=0,Ys=0,Tr=0,Ma=-1,It=[],kr=[],D=[],Ra=.9,ai=0,ki=0,No=!0,ua=.15,qs=navigator.platform;(qs=="iPhone"||qs=="iPad")&&(ua=.7);function Xa(t){var i=Math.floor(t/100),e=(t-i*100)/60;return i+e}function Oo(){_o(),To(),to(),io(),So(),ai=0,Ye.remove(re),re=new Va,re.name="Root:maps",Ye.add(re)}function $a(){this.buildingRoof=this.to(6897728,void 0,!0),this.building=this.to(15327465,void 0,!0),this.buildingPlus=this.to(13487305,void 0,!0),this.buildingIndoor=this.ds(8421631,.7),this.floor=this.ds(15327465,1),this.floor2=this.ds(15921129,1),this.plane=this.ds(16776960,1),this.line=this.ds(12632256,.6),this.line.iCol=D.length,D.push(this.line),D.push(this.line),D.push(this.line),this.mLine=new un({color:8421504}),this.rotSS=this.ds(16711680),this.green=this.ds(65280),D.push(this.green),D.push(this.green),D.push(this.green),D.push(this.green),D.push(this.green),this.yellow=this.ds(16776960),D.push(this.yellow),D.push(this.yellow),D.push(this.yellow),D.push(this.yellow),D.push(this.yellow),this.red=this.ds(16711680),D.push(this.red),D.push(this.red),D.push(this.red),D.push(this.red),D.push(this.red),this.blue=this.ds(255),D.push(this.blue),D.push(this.blue),D.push(this.blue),D.push(this.blue),D.push(this.blue),this.grey=this.ds(8421504),D.push(this.grey),D.push(this.grey),D.push(this.grey),D.push(this.grey),D.push(this.grey),this.grey1=this.ds(6316128,1),this.black=this.ds(0),this.black1=this.ds(0,1),this.blackT=this.ds(0,.2),this.dgruen=this.ds(32768),this.hgruen=this.ds(8454016,1),this.dblau=this.ds(128),this.white=this.ds(16777215),this.white1=this.ds(16777215,1),this.bright=this.ds(12632256),this.grey_root=this.ds(8421504),this.sky=this.ds(49151),this.no_osm=this.ds(16751103),this.raceway=this.ds(16761035,1),this.motorway=this.ds(15241890,1),this.trunk=this.ds(16364188,1),this.primary=this.ds(16570020,1),this.secondary=this.ds(16251583,1),this.footway=this.ds(16744576,1),this.allotments=this.ds(15650739),this.cemetery=this.ds(11193263),this.orchard=this.ds(11460515),this.commercial=this.ds(15915737),this.construction=this.ds(13092788),this.farmland=this.ds(16510167),this.farmyard=this.ds(16112826),this.forest=this.ds(11391390),this.grass=this.ds(13495216),this.landfill=this.ds(11974034),this.industrial=this.ds(15457256),this.park=this.ds(13171404),this.park=this.ds(13495216),this.parking=this.ds(16248759),this.garages=this.ds(14671310),this.pitch=this.ds(8443829),this.quarry=this.ds(12960707),this.playground=this.ds(14547904),this.residential=this.ds(14737375),this.retail=this.ds(16766673),this.societal_am=this.ds(15790296),this.school=this.ds(15790296),this.track=this.ds(10053120),this.land=this.ds(15921129),this.water=this.ds(11915472),this.waterB=this.ds(11915519),this.mud=this.ds(2909078),this.bare_ground=this.ds(15656412),this.heath=this.ds(14080415),this.forest=this.ds(11391390),this.sand=this.ds(16116166),this.scrub=this.ds(11920309),this.bridge=this.ds(12105912),this.airport=this.ds(15329250),this.apron=this.ds(15323647),this.aeroway=this.ds(11579584),this.rest_area=this.ds(15714504),this.pl_o_worship=this.to(13487305),this.steps=this.ds(16416882),this.amenity_brown=this.ds(7555592),this.cTree=[this.amenity_brown,this.green,this.red,this.red],this.cTree.iCol=D.length,D.push(this.amenity_brown),D.push(this.green),this.box3=[this.green,this.green,this.green,this.green,this.green,this.green,this.yellow,this.yellow,this.yellow,this.yellow,this.yellow,this.yellow,this.red,this.red,this.red,this.red,this.red,this.red,this.grey],this.box3.iCol=D.length,D.push(this.green),D.push(this.green),D.push(this.green),D.push(this.green),D.push(this.green),D.push(this.green),D.push(this.yellow),D.push(this.yellow),D.push(this.yellow),D.push(this.yellow),D.push(this.yellow),D.push(this.yellow),D.push(this.red),D.push(this.red),D.push(this.red),D.push(this.red),D.push(this.red),D.push(this.red),D.push(this.blue),D.push(this.blue),D.push(this.blue),D.push(this.blue)}$a.prototype.ss=function(t){var i=new ut({color:t,side:cn});return i.iCol=D.length,D.push(i),i};$a.prototype.ds=function(t,i,e){i||(i=Ra),ve==1&&(e?t=0:t=16777215);var r=!ae&&i<1,a=new ut({color:t,side:Qe,transparent:r,opacity:i});return a.iCol=D.length,D.push(a),a};$a.prototype.to=function(t,i,e){i||(i=Ra),ve==1&&(e?t=0:t=16777215);var r=!ae&&i<1&&!1,a=new ut({color:t,side:Qe,transparent:r,opacity:i});return a.iCol=D.length,a.name=t,D.push(a),a};function g(){return this.geometry=void 0,this}g.prototype.geo=function(t){return this.geometry=t,this};g.prototype.shape=function(t){var i=new Ke(t);return this.geometry=new Ha(i),this};g.prototype.plane=function(t,i){return this.geometry=new St(t,i,1,1),this};g.prototype.box=function(t,i,e){return this.geometry=new Bn(t,i,e),this.geometry.groups=[],this};g.prototype.cyl=function(t,i,e,r,a){return r||(r=16),this.geometry=new la(t,i,e,r),this.geometry.groups=[],a&&(this.geometry.osmID=a,alert("prototype.cyl id: "+a)),this};g.prototype.sph=function(t,i){return i||(i=8),this.geometry=new Za(t,i),this.geometry.groups=[],this};g.prototype.trans=function(t,i,e){var r=new xe().makeTranslation(t,i,e);return this.geometry.applyMatrix4(r),this};g.prototype.scale=function(t,i,e){i||(i=t),e||(e=t);var r=new xe().scale(new Ei(t,i,e));return this.geometry.applyMatrix4(r),this};g.prototype.try2=function(t){var i=new xe().makeTranslation(0,t/2,0);return this.geometry.applyMatrix4(i),this};g.prototype.rotx=function(t){var i=new xe().makeRotationX(k(t));return this.geometry.applyMatrix4(i),this};g.prototype.roty=function(t){var i=new xe().makeRotationY(k(t));return this.geometry.applyMatrix4(i),this};g.prototype.rotyr=function(t){var i=new xe().makeRotationY(t);return this.geometry.applyMatrix4(i),this};g.prototype.rotz=function(t){var i=new xe().makeRotationZ(k(t));return this.geometry.applyMatrix4(i),this};g.prototype.merge=function(t,i){return this.geometry=$i([this.geometry,t.geometry],!1),this};g.prototype.mergeto=function(t){return t.geometry=$i([t.geometry,this.geometry],!1),this};g.prototype.maps=function(t,i,e,r,a,s){var n=new V(this.geometry,t);return n.position.x=i,n.position.z=e,n.position.y=r,n.receiveShadow=a,n.castShadow=s,n.name="NodeGeo",(i||e)&&re.add(n),n};g.prototype.node=function(t,i,e,r){r===void 0&&(r=R),e===void 0&&(e=R),fe>1&&i.filter&&(t=Ee);var a=new V(this.geometry,t);return a.position.x=i.x,a.position.y=i.GetLLm(),a.position.z=i.z,a.receiveShadow=e,a.castShadow=r,a.osm=i,a.name="NodeGeo:"+i.id,wi(a),i.mesh=a,a};g.prototype.nodes=function(t,i,e,r){alert("WEGüüüNodeGeo.prototype.nodes"),r===void 0&&(r=R),e===void 0&&(e=R),fe>1&&i.filter&&(t=Ee);var a=new V(this.geometry,t);return a.position.x=i.x,a.position.y=i.GetLLm(),a.position.z=i.z,a.receiveShadow=e,a.castShadow=r,a.osm=i,a.name=i.id,re.add(a),i.mesh=a,a};function ca(){fi=$("bp","1")*1,this.subView=$("sub",0),me=$("f",""),Ee=new ut({color:8421504,transparent:!1,opacity:.2,side:Qe}),me!=""&&(fe=2,me.substr(0,1)=="!"&&(fe=1,me=me.substr(1)),me.substr(0,1)=="+"&&(fe=3,me=me.substr(1),Ee=new Bt({color:8421504,wireframe:!0,wireframeLinewidth:1}))),fe==2&&sh(!1),yo(),Ye.add(re)}function Fo(t){var i=t.split("|");i.shift();for(var e in i){var r=i[e].split(";"),a=r[0]*1;if(a==0){if(r[2]=="1"){var s=r[3];if(zs!=s){if(zs=s,s.length>60){var n=s.indexOf(" ",55);if(n>0){var h=s.substring(0,n);s=s.substring(n),Vi=ii,ii=Lt,Lt=ti,ti=h}}Vi=ii,ii=Lt,Lt=ti,ti=s,z&&z.Out&&z.Out([Vi,ii,Lt,ti])}}continue}if(!Ji[a]){var l=new V(new Za(1,32,32),cs);l.castShadow=R,l.rotation._order="YXZ";var f=new N(0,0,0);f.AddTag("User name",r[10]),l.osm=f;var d=new _t,u=[];u.push(new Ei(0,0,0)),u.push(new Ei(0,1e3,0));var v=new un({color:16776960});d.setAttribute("position",new Ae(new Float32Array(u),3));var y=new dn(d,v);y.rotation._order="YXZ",l.add(y),Ji[a]=l,Ye.add(l)}var m=Ji[a];if(a==Qi){m.visible=!1;continue}m.position.x=tt(r[4]*1,r[3]*1),m.position.z=it(r[3]*1),m.position.y=r[5]*1,m.rotation.z=k(r[7]*1),m.rotation.y=k(r[6]*1+90),m.children[0].rotation.z=-k(r[7]*1);var w=r[2]=="1";m.visible=w;var M=m.position.x-F.position.x+(m.position.z-F.position.z);m.children[0].visible=Math.abs(M)>250}}function Eo(t){if(qt)var i=t*1;else var i=t*5;if(Q?(i*=7,lt&&(i*=7)):lt&&(i=0),i>1&&(i=1),Oe+=i,Ma!=Math.floor(Oe)){var r=He[Math.floor(Oe)],e=Math.floor(Oe),r=He[e];if(!r){Hi(-2),Ma=-2,alert("replay END (index)");return}if(r.length<22){Hi(-2),Ma=-2,alert("replay END (line)");return}if(qt){for(var a=r.split(",");a[0]=="GPGSA"||a[0]=="GPGSV";)Oe+=1,r=He[Math.floor(Oe)],a=r.split(",");Oe+=1;var u=He[Math.floor(Oe)];if(!u){Hi(-2),alert("replay END (lin2)");return}var v=u.split(","),y=Xa(a[3]*1);a[4]=="S"&&(y*=-1);var m=Xa(a[5]*1);a[6]=="W"&&(m*=-1);var w=v[9]*1-325;w<1.5&&(w=1.5);var s=tt(m,y),n=it(y),h=w,M=w/20;M>30&&(M=30),Tr=(Tr*9+wr)/10;var l=Tr*8-M,d=Jt*2,f=a[8]*1;h<6&&(d=0,l=-15),z.Out(["Log:"+(He.length-Math.floor(Oe))+" - "+Ja,"Tim:"+a[1].substring(0,2)+":"+a[1].substring(2,4)+":"+a[1].substring(4,6),"Pos:"+y.toFixed(6)+"/"+m.toFixed(6),"Ele:"+(v[9]*1).toFixed(1)+"("+w.toFixed(1)+")m  -  V:"+a[7]*1+"m/s"])}else{var a=r.split(";"),s=tt(a[3],a[2]),n=it(a[2]),h=a[4]*1,l=a[6]*1,f=-a[5]*1,d=0;z.Out([a[10],He.length.toString(),Math.floor(Oe)])}Rs=s-gr,gr=s,Xs=n-mr,mr=n,wr=h-yr,yr=h,Bs=l-xr,xr=l,Ys=d-Mr,Mr=d,Jt=f-br,br=f,Jt>180&&(Jt-=360),Jt<-180&&(Jt+=360)}var x=1-(Oe-Math.floor(Oe));F.position.x=gr-Rs*x,F.position.z=mr-Xs*x,F.position.y=yr-wr*x,F.rotation.x=k(xr-Bs*x),F.rotation.z=-k(Mr-Ys*x),F.rotation.y=-k(br-Jt*x),Ma=Math.floor(Oe)}var Ta=0,Sr=0,_r=0,Us="";ca.prototype.update=function(t){if(Ta+=t,Sr+=t,_r+=t,F!==void 0){var i=F.Lon(),e=F.Lat();(Number.isNaN(e)||Number.isNaN(i))&&(e=0,i=0,console.log("NaN lat lon"));var r=kt(F.rotation.y),a=kt(F.rotation.x);if(t>30&&alert(`You have been logged off.
Running in the backround?`),z&&z.gFps>z.fpsMin+0&&_r>.2&&ve!=2){if(_r=0,Qi>0){var s=e.toFixed(8)+";"+i.toFixed(8)+";"+F.position.y.toFixed(2)+";"+r.toFixed(0)+";"+a.toFixed(0)+";0;"+ze;if(hi&&(hi.length>333&&js(hi.substring(0,333)),s+=encodeURI(";"+hi),js("")),oa){var n=0;Us!=s&&(Us=s,n=Qi);var h=new XMLHttpRequest;h.onreadystatechange=function(){h.readyState==4&&h.status==200&&cs.map&&Fo(h.response)},h.open("GET","./xchg.php?pos="+n+";"+s,!0),h.send()}}else if(Qi<-1){sn(-1);var h=new XMLHttpRequest;h.onreadystatechange=function(){if(h.readyState==4&&h.status==200){var I=h.response;I.length>199&&(I="1;karlos;user/X5"),I=I.split(";"),sn(I[0]),I.length>1&&an(I[1]),T>0&&p("!!2!!"+Ya.replace("&","§")),Nt&&(_n(!0),an("karlos")),I.length>2,I.length>3&&(Mn="&access_token="+I[3])}};var l="./login.php?username="+ze+"&lat="+Ze+"&lon="+Ie,f=Le("name");f&&(l+="&name="+f),h.open("GET",l,!0),h.send()}}if(Sr>2){Sr-=2,!Xt&&zi<9e9&&ch(),z&&z.Fps();var d=Math.floor(Ta);if(z&&ve!=2){if(Lt==""&&(d==6&&(j.controlMode==3?z.Out(["FLIGHT-Mode","ARROW-KEYS: left/right-turn, ahead/back"," - - - - ","Press 'x' to change to VIEW- or SEGWAY-Mode","'F1' for help"]):z.Out(["Press 'x' to change to SEGWAY, FLIGHT or VIEW-Mode","'F1' for help"])),d==16&&z.Out([""])),d==3*60&&ze!="karlos"){var l="./mail.php?username="+ze+"&lat="+e+"&lon="+i;console.log("url -----------------------------------",l);var h=new XMLHttpRequest;h.open("GET",l,!0),h.send()}d==5*60&&confirm("5 Minutes online! Would you send me your experience?")==!0&&Tn()}}if(z&&z.Update(t,Ta,-F.rotation.y),Fe==0&&Pi&&Ta>10&&(eh(51.50716135,-.12781402),th()),Fe==0&&!Pi&&(ht(1),ft.QueryOsmTiles(Ie,Ze),Zs("Read OSM-Data"),le&&le&&(le.visible=!0)),We&&le&&(le.rotation.y+=k(.3)),Fe==1&&ft.IsOsmDataAvail()){Ja>15e4&&T!=1.5&&(Oo(),ft.QueryOsmTiles(Ie,Ze)),Cs||(new g().sph(.2).maps(o.grey_root,vi,gi,.5).name="GPS-Aktuell",Cs=new g().sph(.2).maps(o.grey_root,vi,gi,.4).name="GSP-START",Di(-1,"server","segway",0,0,"obj")),ht(2);return}if(Fe==2){if(ft.readJsonData())return;za&&(ki=za),ra&&(ai=ra),sa&&xn(sa),xa=0;for(var u in ue)ue[u].Analyse();var v=o.floor2;fe>1&&(v=Ee);for(var y=We.latIndex,m=We.lonIndex,w=Math.pow(2,At),M=0;M<w;M++)for(O=0;O<w;O++){var x=3,b=y*w+M,P=m*w+O;J[b]||(La(b,P),x=4),J[b][P]||(La(b,P),x=4);var G=J[b][P];G.floor.material=v,G.state=x,x==4&&(G.map.visible=!1)}ht(3);return}if(Oe>=0&&Eo(t),Fe==3){if(this.osmRelations(t))return;ht(4);return}if(Fe==4){if(t<.5&&(xa=0),t>.5&&T<=3&&xa++,xa<5){if(this.osmWays(t))return}else p("x times  dt gross! "+t);ht(5);return}if(Fe==5){if(this.osmNodes(t))return;ht(6);return}if(Fe==6){if(T>2&&p("  render END "+new Date().toLocaleTimeString()),Zs("OSM ok "),gt.length>0&&Is!=gt.length&&(Is=gt.length,We||alert("Filter: "+me+" "+gt.length)),fe==1)for(var S in gt){var E=gt[S],_=new la(5,0,100,3),A=new V(_,o.yellow);A.osm=E,E.idWay>=0||(E=H[E.wayNodes[0]]),A.position.x=E.x,A.position.z=E.z,A.position.y=100/2,pi(A,E.id)}ht(7);var v=o.floor2;if(fe>1&&(v=Ee),We.state==2){We.state=3;for(var y=We.latIndex,m=We.lonIndex,w=Math.pow(2,At),M=0;M<w;M++)for(var O=0;O<w;O++){var b=y*w+M,P=m*w+O,G=J[b][P];if(G.floor.material=v,G.map_Geos.length==0)at("merge map");else{var _=$i(G.map_Geos,!1);_.name="# mGeo #"+b+"/"+P;const Me=new ut({vertexColors:!0,side:Qe});var A=new V(_,Me);A.receiveShadow=R,A.castShadow=R,G.map.add(A)}if(G.oth_Geos.length==0)at("merge more");else{var _=$i(G.oth_Geos,!1);_.name="# oGeo #"+b+"/"+P;const Me=new ut({vertexColors:!0,side:Qe});var W=new V(_,Me);W.receiveShadow=R,W.castShadow=R,G.map.more.add(W)}}}wn(!1),ft.LoadOsmTiles(),Fe==7&&(p("- - Overpass done - -",bn),le&&(le.visible=!1));return}if(Fe==7){if(It.length>0){var Y=It[0],L=Y-1e10;if(L>0){if(mt[L]){var Z=mt[L];Z.Visible(!1)&&It.shift()}}else if(Y>0){if(ue[+Y]){var ne=ue[+Y];ne.mesh&&(ne.mesh.visible=!1),It.shift()}}else if(H[-Y]){var De=H[-Y];De.mesh&&(De.mesh.visible=!1),It.shift()}}else ht(8);return}if(Fe==8&&(kr.length>0?(Ao(kr[0]),kr.shift()):ht(9)),Fe==9&&(ht(11),Nn)){var K=1e3/ci;An.LoadAndPlace((Ie-K).toFixed(8),(Ie+K).toFixed(8),(Ze-K).toFixed(8),(Ze+K).toFixed(8))}Fe>=9&&le&&(le.rotation.y+=k(-.3))}};ca.prototype.osmNodes=function(){if(z&&z.gFps<z.fpsMin+0)return!0;for(var t=ua,i=0;t>0;){if(Ai&&Ai.Place(),!Ai.next)return!1;xn(Ai.next),i=pa.getDelta(),t-=i}return!0};ca.prototype.osmWays=function(){if(le){var t=le.scale.x-.05;t<.2&&(t=.2),le.scale.x=t,le.scale.y=t}if(!ai)return!1;if(z&&z.gFps<z.fpsMin+2)return!0;for(var i=ua,e=0;i>0;){if(ai.Place(),!ai.next)return!1;ai=ai.next,e=pa.getDelta(),i-=e}return!0};ca.prototype.osmRelations=function(){if(z&&z.gFps<z.fpsMin+4)return!0;for(var t=ua,i=0;t>0;){if(ki&&ki.Place(),!ki.next)return!1;ki=ki.next,i=pa.getDelta(),t-=i}return!0};function Di(t,i,e,r,a,s){if(T>1&&p("***** ModelPlace: ",i,e,r,a,s),!(fe>1&&this.filter)){var n=function(u){p("onError",u)},h=function(u){if(u.lengthComputable){var v=u.loaded/u.total*100;T>1.6&&p(Math.round(v,2)+"% downloaded")}},l=function(u){T>2&&p("onLoadedMTL:",u.children);for(var v in u.children){var y=u.children[v];y.castShadow=R,y.receiveShadow=R,(t==4711||t==4717||t==-1)&&y.geometry.computeVertexNormals()}if(t==-1){var m=.6;u.scale.set(m,m,m),u.rotation.y=k(180),u.position.z=-1.954,rh(u)}t==4903&&(u.rotation.y=k(203),u.position.x+=17,u.position.y+=.2,u.position.z+=38);var m=1/32;t==4798&&u.scale.set(m,m,m),t==4798&&(u.rotation.y=k(45)),t==4798&&(u.position.x=2e3),t==4798&&(u.position.z=2e4),t==4711&&(u.rotation.y=k(-101)),t==4712&&(u.rotation.y=k(-99)),t==4713&&u.scale.set(.02,.02,.02),t==4713&&(u.position.y=.4),t==4713&&(u.rotation.y=k(45)),t==4716&&u.scale.set(1,1,1),t==4716&&(u.rotation.y=k(45));var m=2*100/4;t==4717&&u.scale.set(m,m,m),t==4717&&(u.position.y=m*.84);var m=2*50/4;t==4718&&u.scale.set(m,m,m),t==4718&&(u.position.y=m*.84),t==4719&&u.scale.set(.001,.001,.001),t==4719&&(u.rotation.x+=k(-90)),u.position.x+=r,u.position.z+=a,u.castShadow=R,u.receiveShadow=R,re.add(u)};if(s=="obj"){var f=new Rn;f.setPath("models/"),f.load(e+".mtl",function(u){u.preload();var v=new Xn;v.setMaterials(u),v.setPath("models/"),v.load(e+".obj",l,h,n)})}if(s=="dae"&&yi>0){Ls=re;var d=new pn;d.load("models/"+e+".dae",function(u){var v=u.scene.children[0].children,y=v[0];v.length>1&&(y=v[1]),y.rotation.x=k(-90),y.rotation.z=k(90),y.position.x=r,y.position.z=a,t==4719&&(y.rotation.z+=k(-90),y.position.z+=0,y.position.x+=14,y.scale.set(.02,.02,.02)),t==4714&&(y.position.x+=60,y.position.y=-1.954,y.position.z+=45,y.scale.x=.1,y.scale.y=.1,y.scale.z=.1),t==4715&&(y.position.z+=9,y.position.x+=0,y.scale.x=.025,y.scale.y=.025,y.scale.z=.025),y.castShadow=R,Ls.add(y)},h)}}}var Do="https://graph.mapillary.com/",Vs=new Bt({side:Qe}),Wo=new St(4,3,1,1),ri=new V(Wo);ri.name="Mapillary";ri.position.y=-999;function Po(t,i){z.Out(["Mapillary Image ..."]);var e=dt(F.rotation.y,5e-4),r=Do+"images/?radius=1500&per_page=1&closeto="+(i-=e[0])+","+(t-=e[1])+Mn,a=new XMLHttpRequest;a.onreadystatechange=function(){if(a.readyState==4&&a.status==200){var s=JSON.parse(a.responseText);s.features.length<1?z.Out(["Mapillary Image: not in range of 500m"]):zo(s.features[0])}},a.open("GET",r,!0),a.send()}function zo(t,i,e){var r=t.geometry,a=t.properties,s=r.coordinates,n=s[0],h=s[1],l=tt(n,h),f=it(h);k(360-a.ca),(a.ca==359||a.ca==0)&&F.rotation.y;var d=F.position.x-l,u=F.position.z-f,v=Math.atan2(d,u);F.rotation.y=v,ri.position.x=l,ri.position.z=f,ri.position.y=3,ri.rotation.y=v,p("Mapillary:"+a.ca+" "+n+"/"+h),z.Out(["Mapillary Image from: "+a.username,"camera angle: "+a.ca+" test:"+Math.floor(kt(v)),"position: "+n.toFixed(6)+"' /"+h.toFixed(6)+"'","captured at: "+a.captured_at,"camera: "+a.camera_model+" "+a.camera_make]);var y="https://d1cuyjsrcm0gby.cloudfront.net/"+a.key+"/thumb-2048.jpg",m=new fa;m.load(y,function(w){Vs.map=w,ri.material=Vs},function(w){T>2&&p(w.loaded/w.total*100+"% loaded  TextureLoader Image")},function(w){p("An error happened  TextureLoader Image")})}var Hs=new Bt({side:Qe}),Co=new St(4,3,1,1),Rt=new V(Co);Rt.name="Panoramax";Rt.position.y=-999;function Lo(){re.add(Rt)}function Io(t,i){z.Out(["Panoramax Image ..."]);var e=dt(F.rotation.y,5e-4),r="https://api.panoramax.xyz/api/search?place_distance=0-100&place_position="+(i-=e[0])+","+(t-=e[1]);fetch(r).then(a=>a.json()).then(a=>{a.features&&a.features.length>0?Ro(a.features[0],a.features[0].assets.hd.href):z.Out(["No Panoramax features found for the given coordinates."])}).catch(a=>{console.error("Error fetching Panoramax data:",a)})}function Ro(t,i){var e=t.geometry,r=t.properties,a=e.coordinates,s=a[0],n=a[1],h=tt(s,n),l=it(n),f=t.properties["view:azimuth"];(f==359||f==0)&&F.rotation.y;var d=F.position.x-h,u=F.position.z-l,v=Math.atan2(d,u);F.rotation.x=0,F.rotation.y=v,F.position.y=3,Rt.position.x=h,Rt.position.z=l,Rt.position.y=3,Rt.rotation.y=v,p("Panoramax:"+f+" "+s+"/"+n),z.Out(["Panoramax Image from: "+r["geovisio:producer"],"camera angle: "+f,"position: "+s.toFixed(6)+"' /"+n.toFixed(6)+"'","captured at: "+r.exif["Exif.Photo.DateTimeOriginal"],"camera: "+r.exif["Exif.Image.Model"]+" "+r.exif["Exif.Image.Make"]]);var y=new fa;y.load(i,function(m){Hs.map=m,Rt.material=Hs},function(m){T>2&&p(m.loaded/m.total*100+"% loaded  TextureLoader Image")},function(m){p("An error happened  TextureLoader Image")})}var Yt=1/2,Da=0,Xi=k(-10),Ba="";function Zs(t){Ba=t}function dt(t,i){return i||(i=1),[Math.sin(t)*i,Math.cos(t)*i]}var U=null;function Ar(t){U=t}var ka=0,Xo=1,lt=!1,Q=!1,{keyEsc:Jr,keyCmd:Bi,keyCtrl:Gr,keyEnter:$t,keySpace:jt,keyPUp:Kt,keyPDown:Pt,keyUp:st,keyDown:je,keyLeft:qe,keyRight:Ue,key_0:Nr,key_1:Yi,key_2:Sa,key_3:_a,key_4:Aa,key_B:Or,key_C:Fr,key_I:Qs,key_L:Er,key_M:Mi,key_N:Dr,key_O:Wr,key_P:Pr,key_R:zr,key_T:Cr,key_X:Lr,key_Z:Ir}=!1;function Wi(t,i){return Math.sqrt(t*t+i*i)}function Tn(){var t="mailto:karlos@osmgo.org?subject="+escape("OSM-go Test Report")+"&body=Was it fun, ok or a disaster? Please send what you experienced";window.location.href=t}function Ce(t){t||(t=0),this.val=t}Ce.prototype.stop=function(){this.val=0};Ce.prototype.update=function(t,i,e,r,a,s,n,h){{s>=Yt&&(r=0),n||(n=0),a==0&&(a=1e33);var l=!0,f=0;if(t&&(i&&(this.val>=0?f=r:f=r*10,this.val+=f*s,this.val>+a&&(this.val=+a),l=!1),e&&(this.val<=0?f=r:f=r*10,this.val-=f*s,this.val<-a&&(this.val=-a),l=!1)),l)if(n>0){var d=n*s;Math.abs(this.val)<d?this.val=0:this.val>0?this.val-=d:this.val+=d}else{var d=this.val*10*s;Math.abs(this.val)<Math.abs(d)?this.val=0:this.val-=d}return this.val*s}};function ls(t,i,e){e||(e=1e33),i||(i=t),this.aMax=e,this.aUp=t,this.aDown=i,this.val=0,this.pass0=0}ls.prototype.slow=function(t,i){{t>=Yt&&(t=Yt);var e=i*t;Math.abs(this.val)<e?this.val=0:this.val>0?this.val-=e:this.val+=e}};ls.prototype.update=function(t,i,e,r){{var a=!0;if(t){var s=this.val,n=this.aUp*r;r>=Yt&&(n=0),i?(a=!1,this.val<0&&(n*=4),s=this.val+n,s>+this.aMax&&(s=+this.aMax)):e?(a=!1,this.val>0&&(n*=2),s=this.val-n,s<-this.aMax&&(s=-this.aMax)):this.pass0=0,this.val!=0&&Math.sign(this.val)!=Math.sign(s)&&(this.pass0=.3,this.val=0),this.pass0>0?this.pass0-=r:this.val=s}if(a)if(this.aDown>0&&!Jr){var h=this.aDown*r;Math.abs(this.val)<h?this.val=0:this.val>0?this.val-=h:this.val+=h}else{var h=this.val*10*r;this.val-=h}return this.val*r}};function Bo(r,e){T>2&&p("goControl INIT - Constructor"),this.DOcontrols=new qo(e);var e=e,r=r;this.screenOrientation=window.orientation||0,this.heading=0,this.wWidth=0,this.wHeight=0,this.wMin=0,this.wMax=0,this.PointVStart=0,this.PointHStart=0,Le("ele")&&Xr(Le("ele")*1),Le("dir")&&(Da=k(Le("dir"))),Le("view")&&(Xi=k(Le("view"))),this.controlMode=$("con",1),this.controlMode<1&&(this.controlMode=1),ve==2&&(this.controlMode=2),this.controlMode==2&&(Xr(1.6),Xi=0);var a=0,s=qa,n=0,h=0,l=0,f=0,d=0,u=Xi,v=Da,y=0,m=0,w=0,M=0,x=0,b=0,P=0,G=0,S=0,E=0,_=!1,A=!1,O=!1,W=0,Y,L=0,Z,ne=1,De=1,K=!1,ie=0,I=1.1,ce,ge,Ot,Ft,rt,q,Ne=ae;if(this.wWidth=Ve.offsetWidth,this.wHeight=Ve.offsetWidth,ae==-1&&(Gi&&this.wWidth>this.wHeight||kn(0)),ae){this.controlMode=2,s=1.6,Xr(s),u=Xi=0;var Me=new St(5,1),se=new ut({color:16711680,side:Qe}),ct=new V(Me,se);ct.position.z=-10,Ye.add(ct)}Ba="no GPS",p>2&&p("--- no GPS - browser/device ---"),this.speedPosF=new ls(10,.1),this.intPosF=new Ce,this.intPosR=new Ce,this.intPosY=new Ce,this.intPo2F=new Ce,this.intPo2Y=new Ce,this.intRotX=new Ce,this.intRotY=new Ce,this.intRotZ=new Ce,this.int3dmrDir=new Ce,this.int3dmrLft=new Ce,this.int3dmrBak=new Ce,this.int3dmrEle=new Ce,this.int3dmrSiz=new Ce,this.kmt=0,ve!=2&&(this.Flight=new Uo);var Et=new XMLHttpRequest;Et.onreadystatechange=function(){},Et.open("GET","user/notes.txt",!0),Et.setRequestHeader("Cache-Control","no-cache"),Et.send(),this.Fullscreen=function(){document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():Ve.requestFullscreen?Ve.requestFullscreen():Ve.msRequestFullscreen?Ve.msRequestFullscreen():Ve.mozRequestFullScreen&&Ve.mozRequestFullScreen()},this.onWindowResize=function(){{this.wWidth=Ve.offsetWidth,this.wHeight=Ve.offsetHeight,e.aspect=this.wWidth/this.wHeight,e.updateProjectionMatrix();var c=1;navigator.platform=="iPhone"&&(c=.7),ae||(this.wMin=this.wHeight,this.wMax=this.wWidth,this.wWidth<this.wHeight?(this.wMin=this.wWidth,this.wMax=this.wHeight,we.top=c,we.right=c*e.aspect):(we.right=c,we.top=c/e.aspect),we.left=-we.right,we.bottom=-we.top,we.updateProjectionMatrix()),z&&z.Resize(),ae?ds.setSize(this.wWidth,this.wHeight):r.setSize(this.wWidth,this.wHeight)}},this.onScreenOrientation=function(){this.screenOrientation=window.orientation||0,this.Fullscreen()},this.Stop=function(){lt=Q=st=je=Kt=Pt=Ue=qe=$t=jt=!1},this.Reset=function(c){this.Stop(),S=0,e.fov=zt,Ne=ae,this.intPosF.stop(),this.intRotX.stop(),this.intRotY.stop(),this.intRotZ.stop(),c&&(e.position.set(vi,qa,gi),e.rotation.set(Xi,Da,0))},this.WalkPosi=function(c,C){var ye=e.rotation.y;n=ce+Math.sin(ye)*c+Math.cos(ye)*C,h=rt+Math.sin(ye)*-C+Math.cos(ye)*c},this.WalkPosAd=function(c,C){var ye=e.rotation.y;l+=Math.sin(ye)*c+Math.cos(ye)*C,d+=Math.sin(ye)*-C+Math.cos(ye)*c};var va=new vn;this.update=function(c){{T>9&&p("goControl update START");var c=va.getDelta()+1e-6;q=e.position.y,c>40*Yt&&(this.Stop(),p("-------- max_dt*4: "+c),c=Yt);var C=0,ye=0,Vt=0;if(Ne){this.DOcontrols.update(),this.screenOrientation==0?C=k(-95)+this.DOcontrols.beta:(C=k(85)-this.DOcontrols.gamma,C>Math.PI/2&&(C-=Math.PI));var bt=this.DOcontrols.alpha-this.DOcontrols.alphaOffsetAngle;this.DOcontrols.gamma>0&&(bt-=k(180)),bt>k(180)&&(bt-=k(360)),bt<k(-180)&&(bt+=k(360));var Ht=Math.abs(bt)-k(10);Ht>0&&(this.DOcontrols.alphaOffsetAngle+=Ht*Math.sign(bt)*c*1)}if(C!=0){var Dt=Math.abs(C)-k(10);Dt>0&&(C=Dt*Math.sign(C)),Vt=Math.min(C*C*200,10)*Math.sign(C),Vt>0&&(Vt/=10),ye=Math.min(Math.max(Vt-S,-20),20),S+=ye*c,G=S*c,P=0}S*=1-c/10,(qe||Ue)&&(S*=1-c*5),Jr&&(S*=1-c*10,z&&z.Out(),this.Stop(),z&&z.Out([Vi,ii,Lt,ti]));var vs=Math.abs(e.rotation.y-E)/c;E=e.rotation.y,S*=Math.max(1-vs*1,0),Ba=vs.toFixed(2)+":r a:"+ye.toFixed(2)+" v:"+Vt.toFixed(2)+" i:"+S.toFixed(2)+" s:"+G.toFixed(2),Or&&(Or=!1,We.state=1,wn(!1),ft.LoadOsmTiles());var Te=Math.abs(e.position.y)/2;Te<1&&(Te=1);var gs=Te=Math.sqrt(Te)*Xo,Li=(lt||Q||K)&&U==null,ga=!(lt||Q||K)&&U==null,Fn=U==null;if(this.controlMode==1&&!Ne&&(G=this.intPosF.update(ga,je,st,50,0,c)*gs,P=this.intPosR.update(ga,Ue,qe,50,0,c)*Te,f+=this.intPosY.update(Li,$t,jt,100,0,c)*Te,f+=this.intPosY.update(Fn,Kt,Pt,100,0,c)*Te,f+=this.intPo2Y.update(ga,jt,$t,50,0,c)*Te*-Math.sin(e.rotation.x),G+=this.intPo2F.update(ga,jt,$t,50,0,c)*Te*+Math.cos(e.rotation.x),w=this.intRotY.update(Li,qe,Ue,5,2,c,5*5)*e.fov/zt,m=this.intRotX.update(Li,st,je,5,2,c,5*5)*e.fov/zt,U!=null)){var xt=U.children[0].position,ar=1/U.info.scale;xt.x-=this.int3dmrLft.update(Q,qe,Ue,5,4,c)*ar,xt.y+=this.int3dmrEle.update(!0,Kt,Pt,5,4,c)*ar,xt.z-=this.int3dmrBak.update(Q,st,je,5,4,c)*ar,U.rotation.y+=this.int3dmrDir.update(!Q,qe,Ue,5,4,c)*.1,U.scale.x*=1+this.int3dmrSiz.update(!Q,st,je,.5,4,c),U.scale.y=U.scale.z=U.scale.x,(Nr||Wr)&&(xt.x=U.info.translation[0],xt.z=U.infonslation[1],xt.y=U.infonslation[2],U.scale.x=U.scale.y=U.scale.z=U.info.scale,U.rotation.y=k(-U.osm.GetTag("direction",0)-U.info.rotation)),U.rotation.y>k(360)&&(U.rotation.y-=k(360)),U.rotation.y<k(0)&&(U.rotation.y+=k(360)),z.Out(["ACTUAL:","direction and scale: "+Math.floor((360-kt(U.rotation.y))*10)/10+" & "+Math.floor(U.scale.x*1e4)/1e4,"origin: [right,back,up]: "+Math.floor(xt.x*100)/100+", "+Math.floor(xt.z*100)/100+", "+Math.floor(xt.y*100)/100,"TAGS/REPOSITORY - 3dmr.eu/model/"+U.info.id,"direction-tag/rotation & scale: "+U.osm.GetTag("direction","NoTag")+"/"+U.info.rotation+" & "+U.info.scale,"orgin [right,back,up] "+U.info.translation[0]+", "+U.info.translation[1]+", "+U.info.translation[2]])}if(this.controlMode==2&&!Ne&&((qe||Ue)&&this.speedPosF.slow(c,10),G=this.speedPosF.update(!Q,je,st,c)*gs,P=this.intPosR.update(Q,Ue,qe,10,0,c)*Te,f+=this.intPosY.update(Q,st,je,10,0,c)*Te,f+=this.intPosY.update(!0,Kt,Pt,50,0,c)*2,w=this.intRotY.update(!Q,qe,Ue,5,4,c)*e.fov/zt,m=this.intRotX.update(!Q,jt,$t,5,4,c)*e.fov/zt,e.position.y>1.6&&(f-=9.8*c,P=-w*5,w/=5,e.rotation.z=w*4,e.rotation.x=(e.rotation.x*9+G)/14)),this.controlMode==3&&!Ne){var ys,ws,ya=0,wa=0,rr=0;if(qe&&(ya=900),Ue&&(ya=-900),st&&(wa=-1e4),je&&(wa=1e4),Kt&&(rr=1),Pt&&(rr=-1),_){var $e=500;ya+=-Z/this.wMin*$e,wa+=+Y/this.wMin*$e}if(ys=-wa*.01,ws=-ya*.1,ve!=2){this.Flight.cycle(c*1e3,ws,ys,rr,0);var mi=this.Flight.fObj(),Wt=+mi.rotation.y,En=-mi.rotation.x,Mt=22,ms=7;Se=="delorean"&&(Mt=5,ms=2),e.position.copy(mi.position),e.position.y+=Mt/2*Math.sin(En)+ms,e.position.x+=Mt*Math.sin(Wt),e.position.z+=Mt*Math.cos(Wt),e.position.z+=Mt/8*Math.sin(Wt),e.position.x+=Mt/8*Math.cos(Wt),e.rotation.x=mi.rotation.x-k(10),e.rotation.y=mi.rotation.y,e.rotation.z=mi.rotation.z}}if(this.WalkPosAd(G,P),a=this.intRotZ.update(!0,Ir&&!Q,Ir&&Q,10,0,c),e.fov-=a,e.fov>120&&(e.fov=120),e.fov<.01&&(e.fov=.01),this.controlMode==1){var $e=160;_&&(Li?(u=+Y/this.wMin*2+ge,v=+Z/this.wMin*2+Ft):(x=-Z/this.wMin*$e/5*(Te/3),b=-Y/this.wMin*$e/5*(Te/3),this.WalkPosi(b,x))),A&&(u=+Y/this.wMin*2+ge,v=+Z/this.wMin*2+Ft),ie!=0&&(Li?f+=ie*I*Te:(f+=ie*I*Te*Math.sin(e.rotation.x),this.WalkPosAd(-ie*1*Te*Math.cos(e.rotation.x),0))),A&&(f-=(De/ne-1)*5*Math.sin(e.rotation.x),this.WalkPosAd((De/ne-1)*5,0)),O&&(s=Ot+Y/this.wMin*$e,x=-Z/this.wMin*$e,this.WalkPosi(0,x))}if(this.controlMode==2){var $e=50;_&&(Q?(u=+Y/this.wMin*2+ge,x=-Z/this.wMin*$e,this.WalkPosi(0,x)):(x=-Z/this.wMin*$e/10,b=-Y/this.wMin*$e/2*(Te/1.5),this.WalkPosi(b,x),v=+Z/this.wMin*2+Ft)),A&&(u=+Y/this.wMin*2+ge,x=-Z/this.wMin*$e,this.WalkPosi(0,x)),ie!=0&&(f+=ie*I*Te)}if(Pr&&(Pr=!1,Q?Po(e.Lat(),e.Lon()):Io(e.Lat(),e.Lon())),zr&&(zr=!1,!Q&&!lt&&!Gr&&!Bi&&(alert("Send Test Report?"),Tn())),(Nr||Wr)&&this.Reset(!0),Lr&&z)switch(Lr=!1,this.controlMode++,this.controlMode>3&&(this.controlMode=1),si&&(si.visible=this.controlMode==2),ah.visible=this.controlMode==1,ot.visible=this.controlMode==3,e.rotation.z=0,this.controlMode){case 1:z.Out(["### Controls in VIEW-Mode","ARROW-KEYS or WASD: slide +SHIFT: turn","ENTER/SPACE: distance, +SHIFT: elevate","","MOUSE 1st: side, 2nd: turn, wheel: distance"]);break;case 2:z.Out(["+++Controls in AVATAR-Mode","ARROW-KEYS: left/right-turn, ahead/back","ARROW-KEYS+SHift: elevate, shift right/left","ENTER/SPACE: look up/down","","MOUSE: 1st like keys","MOUSE: 2nd: look up/down, slide right/left"]),e.position.y=1.6,e.rotation.x=0;break;case 3:z.Out(["+++Controls in PLANE-Mode","Will take of and land by speed atomaticly","ARROW-KEYS: left/right-turn, ahead/back","","MOUSE/TOUCH: yes, try it!"]);break;default:z.Out(["+++Controls ILLEGAL-Mode!!!"])}if(Oe<0){n!=0&&(e.position.x=n),s!=0&&(e.position.y=s),h!=0&&(e.position.z=h),u!=0&&(e.rotation.x=u),v!=0&&(e.rotation.y=v),y!=0&&(e.rotation.z=y),e.rotation.x+=m,e.position.x+=l,ce+=l,e.rotation.y+=w,e.position.y+=f,Ot+=f,e.rotation.z+=M,e.position.z+=d,rt+=d;var sr=1;e.position.y<=0&&q>0&&this.controlMode<3&&(alert("Do you realy want to go under ground? Use key 'Page-Up' do go up"),Gr=lt=Q=Bi=je=Pt=!1);var sr=e.position.y-1.5;Math.abs(sr)<1&&(e.position.y-=sr*1*c),pt.target.position.x=e.position.x,pt.target.position.z=e.position.z,e.rotation.y>k(360)&&(e.rotation.y-=k(360)),e.rotation.y<k(0)&&(e.rotation.y+=k(360));var ma=89;if(e.rotation.x<-k(ma)&&(e.rotation.x=-k(ma)),e.rotation.x>+k(ma)&&(e.rotation.x=+k(ma)),!st&&!je&&!$t&&!jt&&T!=1.5&&(e.rotation.x>k(30)&&e.position.y>0&&(e.rotation.x*=1-.95*c*(Math.abs(e.rotation.x)-k(30))),e.rotation.x<k(-30)&&e.position.y<0&&(e.rotation.x*=1-.95*c*(Math.abs(e.rotation.x)-k(30)))),this.controlMode==1){var Wt=e.rotation.y,Mt=20;Be.position.copy(e.position),Be.position.y-=8,Be.position.x-=Mt*Math.sin(Wt),Be.position.z-=Mt*Math.cos(Wt),Be.rotation.y=1.1*Wt}}if(Ni&&Ni.position.set(e.position.x,0,e.position.z),Math.abs(e.position.x<ha)||Math.abs(e.position.z>zi)||Math.abs(e.position.x>er)||Math.abs(e.position.z<tr)||Mi){var nr=e.Lon(),or=e.Lat();if(Mi&&!Q){var oe=ui+"/map?go=1&lat="+or.toFixed(8)+"&lon="+nr.toFixed(8)+"&user="+ze;ae&&(oe+="&card="+ae),oa&&(oe+="&multi=1"),T>1&&p("Map-url: ",oe),window.open(oe,"_self"),Mi=!1;return}if(Mi&&Q){T==1.5&&hn(0),le&&(le.visilble=!0);var Dn=kt(e.rotation.y),Wn=kt(e.rotation.x),oe=ui+window.location.pathname+"?km=1&lat="+or.toFixed(8)+"&lon="+nr.toFixed(8)+"&ele="+e.position.y.toFixed(2)+"&dir="+Dn.toFixed(0)+"&view="+Wn.toFixed(0)+"&user="+ze+"&dbg="+T;oe+="&con="+this.controlMode,z.fpsMin!=10&&(oe+="&fps="+z.fpsMin),ae&&(oe+="&card="+ae),Nt&&(oe+="&sim="+Nt),ve&&(oe+="&cu="+ve),na>1&&(oe+="&ser="+na),yi!=99&&(oe+="&mdl="+yi),pe!=17&&(oe+="&vil="+pe),At!=1&&(oe+="&dil="+At),Se!=4&&(oe+="&fly="+Se),zt!=40&&(oe+="&zoom="+zt/40),Zi&&(oe+="&id="+Zi),lt?(hn(0),Pe==0?oe+="&tiles=3":oe+="&tiles=1"):oe+="&tiles="+Pe,oe+="&opt="+Ci,T>1&&p("Reload-url: ",oe),window.open(oe,"_self"),Mi=!1;return}ft.QueryOsmTiles(nr,or)}if(e.position.y>500&&T!=1.5&&(e.position.y=500),n=u=l=m=0,ie=0,s=v=f=w=0,h=y=d=M=0,si!=null){var hr=dt(e.rotation.y-k(90),.15),lr=dt(e.rotation.y-k(180),.45);ae&&(hr=dt(this.DOcontrols.alphaOffsetAngle-k(90),.15),lr=dt(this.DOcontrols.alphaOffsetAngle-k(180),.45)),si.rotation.y=e.rotation.y+k(180),si.position.set(e.position.x-hr[0]+lr[0],.5,e.position.z-hr[1]+lr[1])}if(this.heading=Math.floor(this.DOcontrols.heading||0)+kt(this.DOcontrols.orient||0),this.heading>360&&(this.heading-=360),this.DOcontrols.alphaOffsetAngle==0&&this.heading!=0&&!ae&&(this.DOcontrols.updateAlphaOffsetAngle(-k(this.heading)),p(this.heading),alert("hhh"+this.heading)),Gi||(this.heading=-kt(e.rotation.y)),Yi&&Q&&(Yi=!1,Ga()),Yi&&!Q&&(Yi=!1,Na()),Sa&&Q&&(Sa=!1,Ga()),Sa&&!Q&&(Sa=!1,Na()),_a&&Q&&(_a=!1,Ga()),_a&&!Q&&(_a=!1,Na()),Aa&&Q&&(Aa=!1,Ga()),Aa&&!Q&&(Aa=!1,Na()),Er){Er=!1;var Ii=void 0,bs=9e9;for(var Pn in Ji){var fr=Ji[Pn],xs=Math.abs(fr.position.x-e.position.x),Ms=Math.abs(fr.position.y-e.position.y),Ts=Math.sqrt(xs*xs+Ms*Ms);bs>Ts&&(bs=Ts,Ii=fr.position)}Ii&&(e.position.x=Ii.x,e.position.y=Ii.y,e.position.z=Ii.z+50,e.rotation.x=0,e.rotation.y=0)}if(Dr){Dr=!1;var Zt=prompt("Place a GO-note:","");if(Zt){var dr=new N(ja,e.Lat(),e.Lon());dr.AddTag("GO-Note",Zt),dr.AddTag("From"," you "),fs(),dr.Place(0);var Ri=new XMLHttpRequest;Ri.open("GET","./xchg.php?note="+ze+";"+e.Lat()+";"+e.Lon()+";"+Zt,!0),Ri.send()}}if(Fr||Cr){Fr=Cr=!1,z.Out([Vi,ii,Lt,ti]),_n(!0);var Zt=prompt("Chat:","");if(p("CHAT:"+Zt),Zt){var Ri=new XMLHttpRequest;Ri.open("GET","./xchg.php?chat="+ze+":"+Zt+";#######",!0),Ri.send()}}Qs&&(Q?z.Height(-c):z.Height(+c)),T>9&&p("goControl update ENDE")}},this.PointStart=function(c){{Z=Y=0,ce=e.position.x,ge=e.rotation.x,Ot=e.position.y,Ft=e.rotation.y,rt=e.position.z,e.rotation.z;var C=7;Gi&&(C=5),K=L>this.wWidth-this.wMax/C&&W<this.wMax/C,Ne=!1,T>1&&p("PointStat "+K+" "+L+"-"+this.wWidth+"  "+W+"-"+this.wMax/C)}},this.PointEnd=function(c){Math.abs(Z)<4&&Math.abs(Y)<4&&(T>2&&p("Klick/Tap",Z+"/"+Y),z&&_&&z.Point(L,W)),K=!1},this.onContextMenu=function(c){c.preventDefault()},this.onMouseWheel=function(c){c.preventDefault(),ie=0,c.wheelDelta!==void 0?ie=c.wheelDelta:c.detail!==void 0&&(ie=-c.detail),ie!=0&&(Math.abs(ie)!=1&&p("Wheel:",ie),ie>0?ie=1:ie=-1),Ne=!1},this.onMouseDown=function(c){{if(ae)return;switch(this.kmt++,c.preventDefault(),c.stopPropagation(),this.PointHStart=L=c.pageX,this.PointVStart=W=c.pageY,this.PointStart(),c.button){case 0:_=!0,p("Mouse F:",L,W);break;case 2:A=!0,_=!1,p("Mouse S:",L,W);break;case 1:O=!0,A=!1,p("Mouse T:",L,W);break}var C="default";_&&(C="move"),A&&(C="pointer"),document.getElementById("container").style.cursor=C}},this.onMouseMove=function(c){{if(ae)return;L=c.pageX,Z=L-this.PointHStart,W=c.pageY,Y=W-this.PointVStart}},this.onMouseUp=function(c){{if(ae)return;switch(c.preventDefault(),c.stopPropagation(),this.PointEnd(),_=A=O=!1,c.button){case 0:_=A=O=!1,p("mouse-F:",L,W);break;case 2:A=O=!1,p("mouse-S:",L,W);break;case 1:O=!1,p("mouse-T:",L,W);break}document.getElementById("container").style.cursor="default"}},this.onfokus=function(c){this.Stop()},this.onKeyDown=function(c){this.onKeyX(c,!0),Ne=!1,this.kmt++,T>0&&p("KEYv:"+(c.code||c.key)+" "+(c.timeStamp-ka)),ka=c.timeStamp},this.onKeyUp=function(c){this.onKeyX(c,!1),T>1&&p("Key^:"+c.code+" "+(c.timeStamp-ka)),ka=c.timeStamp},this.onKeyX=function(c,C){{Q=c.shiftKey,lt=c.altKey,Gr=c.keyCtrl;var ye=c.keyCode;if(lt&&Bi&&ye!=lt&&ye!=Bi){qe=Ue=!1;return}switch(ye){case 16:break;case 65:case 37:qe=C,Ue=!1;break;case 87:case 38:st=C,je=!1;break;case 68:case 39:Ue=C,qe=!1;break;case 83:case 40:je=C,st=!1;break;case 171:case 221:case 187:case 36:case 33:Kt=C,Pt=!1;break;case 198:case 163:case 222:case 220:case 35:case 34:Pt=C,Kt=!1;break;case 12:case 13:$t=C;break;case 32:jt=C;break;case 17:break;case 18:break;case 27:Jr=C;break;case 91:case 224:Bi=C;break;case 48:Nr=C;break;case 49:Yi=C;break;case 57:Jo();break;case 66:Or=C,ps();break;case 67:Fr=C;break;case 72:if(!C){z&&z.DbgOn(0);break}case 73:Qs=C;break;case 76:Er=C;break;case 77:Mi=C;break;case 78:Dr=C;break;case 79:Wr=C;break;case 80:Pr=C;break;case 82:zr=C;break;case 84:Cr=C;break;case 88:Lr=C;break;case 90:Ir=C;break;case 63:case 112:if(!C){window.open(be+"osmgo.org/info","_blank");break}default:z&&z.Out(["**** CONTROLS","?: Or 'F1' for help","0: Or 'o' for teleport home (Start position)","X: Switch between View- and Avatar-Mode","1: Recall position marker. Shift-1 to set","P: Show nearest Panoramax/Mapillary Picture","M: Goto to 2D-Map.  Shift-M reload and show URL","Esc: to stop all moves - WASD: like the cursorkeys","**** MULTIUSER","C: or T: Chat (global)","N: Node place (global)","Z: Zoom in. Shift-Z: Zoom out","L: FoLLow other present user (experimental)","**** DEBUG","R: Send test-Report by mail","B: Blocked Tileload repeat","H: Headup Display Info on","9: More Debug-Log outputs","I: Increase height of selected. Shift-I to decrease","**** HAVE FUN!"])}}},this.onTouchStart=function(c){switch(c.preventDefault(),this.kmt++,c.preventDefault(),c.stopPropagation(),_=!1,A=!1,O=!1,Z=0,Y=0,c.touches.length){case 1:_=!0,this.PointHStart=L=c.touches[0].pageX,this.PointVStart=W=c.touches[0].pageY,this.PointStart(),p("Point F:",L,W);break;case 2:A=!0,this.PointHStart=L=(c.touches[0].pageX+c.touches[1].pageX)/2,this.PointVStart=W=(c.touches[0].pageY+c.touches[1].pageY)/2,this.PointStart(),p("Point S:",L,W),De=ne=Wi(c.touches[0].pageX-c.touches[1].pageX,c.touches[0].pageY-c.touches[1].pageY);break;case 3:O=!0,this.PointHStart=L=c.touches[0].pageX,this.PointVStart=W=c.touches[0].pageY,this.PointStart(),p("Point T:",L,W);break}},this.onTouchMove=function(c){c.preventDefault();{if(!_&&!A&&!O)return;c.preventDefault(),c.stopPropagation(),L=c.touches[0].pageX,W=c.touches[0].pageY,c.touches.length>=2&&(ne=Wi(L-c.touches[1].pageX,W-c.touches[1].pageY),L=(L+c.touches[1].pageX)/2,W=(W+c.touches[1].pageY)/2),Z=L-this.PointHStart,Y=W-this.PointVStart}},this.onTouchEnd=function(c){c.preventDefault(),c.preventDefault(),c.stopPropagation(),this.PointEnd(),_=A=O=!1},this.onbeforeunload=function(){alert("onbeforeunload"),p("onbeforeunload")},this.onWindowResize(),window.addEventListener("orientationchange",function(c){j.onScreenOrientation(c)},!1),window.addEventListener("resize",function(c){j.onWindowResize(c)},!1),window.addEventListener("onbeforeunload",function(){j.onbeforeunload()},!1),window.addEventListener("onfokus",function(c){j.onFokus(c)},!1),window.addEventListener("onfokusout",function(c){j.onFokus(c)},!1),document.addEventListener("keydown",function(c){j.onKeyDown(c)},!1),document.addEventListener("keyup",function(c){j.onKeyUp(c)},!1),Gi?(document.addEventListener("gesturestart",function(c){c.preventDefault()},!1),document.addEventListener("touchstart",function(c){j.onTouchStart(c)},!1),document.addEventListener("touchmove",function(c){j.onTouchMove(c)},!1),document.addEventListener("touchend",function(c){j.onTouchEnd(c)},!1)):(document.addEventListener("mousedown",function(c){j.onMouseDown(c)},!1),document.addEventListener("mousemove",function(c){j.onMouseMove(c)},!1),document.addEventListener("mouseup",function(c){j.onMouseUp(c)},!1),document.addEventListener("mousewheel",function(c){j.onMouseWheel(c)},!1),document.addEventListener("DOMMouseScroll",function(c){j.onMouseWheel(c)},!1),document.addEventListener("contextmenu",function(c){j.onContextMenu(c)},!1)),T>2&&p("goControl ENDE - Constructor")}function Ga(){var t="OSM_go_posrot="+F.position.x+" "+F.position.y+" "+F.position.z+" "+F.rotation.x+" "+F.rotation.y+" "+F.rotation.z+" ";document.cookie=t,T>0&&p(t)}function Na(){if(document.cookie.indexOf("OSM_go_posrot")!=-1){var t=Yo("OSM_go_posrot");T>0&&p("cookie",t);var i=t.split(" ");F.position.x=parseFloat(i[0]),F.position.y=parseFloat(i[1]),F.position.z=parseFloat(i[2]),F.rotation.x=parseFloat(i[3]),F.rotation.y=parseFloat(i[4]),F.rotation.z=parseFloat(i[5]),F.updateProjectionMatrix()}}function Yo(t){for(var i=t+"=",e=document.cookie.split(";"),r=0;r<e.length;r++){for(var a=e[r];a.charAt(0)==" ";)a=a.substring(1);if(a.indexOf(i)!=-1)return a.substring(i.length,a.length)}return""}var qo=function(t){var i=this;this.camera=t,this.camera.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffsetAngle=0,this.alpha=0,this.beta=0,this.gamma=0,this.heading=0;var e=function(){var r=new Ei(0,0,1),a=new Yn,s=new As,n=new As(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(h,l,f,d,u){a.set(f,l,-d,"YXZ"),h.setFromEuler(a),h.multiply(n),h.multiply(s.setFromAxisAngle(r,-u))}}();this.connect=function(){},this.disconnect=function(){},this.update=function(){if(i.enabled!==!1){this.heading=i.deviceOrientation.webkitCompassHeading?i.deviceOrientation.webkitCompassHeading:0;var r=(i.deviceOrientation.alpha?k(i.deviceOrientation.alpha):0)+this.alphaOffsetAngle,a=i.deviceOrientation.beta?k(i.deviceOrientation.beta):k(95),s=i.deviceOrientation.gamma?k(i.deviceOrientation.gamma):0,n=i.screenOrientation?k(i.screenOrientation):0;e(i.camera.quaternion,r,a,s,n),this.beta=a,this.gamma=s,this.alpha=r}},this.updateAlphaOffsetAngle=function(r){this.alphaOffsetAngle=r,this.update(),alert("updateAlphaOffsetAngle: "+r)},this.dispose=function(){this.disconnect()},this.connect()},Uo=function(){var t=0,i=0;return{init:function(e){this.flightObj=e,this.velCur=0,this.accCur=0,this.powFakt=.3},fObj:function(){return this.flightObj},cycle:function(e,r,a,s,n){{var h=10,l=9.5,f=25;e>100&&(e=100);var d=this.flightObj,u=d.position.x,v=d.position.y,y=d.position.z,m=d.rotation.x*180/Math.PI,w=d.rotation.y*180/Math.PI,M=d.rotation.z*180/Math.PI,x=r-t,b=a-i,P=.5*e,G=.5*e;x>0?x>+P&&(x=+P):x<-P&&(x=-P),b>0?b>+G&&(b=+G):b<-G&&(b=-G),t+=x,i+=b,s?(this.powFakt*=1+1*s*e/1e3,this.powFakt>20&&(this.powFakt=20),this.powFakt<1&&(this.powFakt=1)):this.powFakt>1&&(this.powFakt*=1-e/1e3);var S=t;S<-f?S=-f:S>+f&&(S=+f);var E=i;E<-l?E=-l:E>+l&&(E=+l),this.accCur+=(E-this.accCur)*e*.002,this.velCur+=this.accCur*e*.004;var _=h+2+v*.26*this.powFakt;if(this.velCur<0?this.velCur=0:this.velCur>_?this.velCur=_:v>n&&this.velCur<h+1&&(this.velCur=h+1),this.velCur>h){var A=this.accCur*this.powFakt;this.dhCur+=(A-this.dhCur)*e*1e-4,v+=this.accCur*e*(v+3)*5e-5}var O=this.velCur;v>n&&(O=h+(v-n)*this.powFakt*.5);var W=0,Y=0;v<=n+1e-4?(v=n,this.velCur-=this.velCur*e*.002):(W=this.accCur,Y=-S*1.5),m+=(W-m)*e*.006,M+=(Y-M)*e*.001,w+=M*e*.002,w>=360?w-=360:w<0&&(w+=360);var L=w*Math.PI/180,Z=Math.sin(L),ne=Math.cos(L),De=O*e*.001;u-=Z*De,y-=ne*De,d.position.set(u,v,y),d.rotation.set(m*Math.PI/180,w*Math.PI/180,M*Math.PI/180)}}}};function Vo(){T>2&&p("KeepRight Init");var t=new XMLHttpRequest;t.onreadystatechange=function(){t.readyState==4&&t.status==200&&(p("KeepRight ... Query beantwortet"),Ho(t.responseText))},t.onprogress=function(i){T>0&&p("KeepRight progress - loaded,total: ",i.loaded,i.total)},this.LoadAndPlace=function(i,e,r,a){{var s="30,40,50,70,90,100,110,120,130,150,160,170,180,191,192,193,194,195,196,197,198,201,202,203,204,205,206,207,208,210,220,231,232,270,281,282,283,284,285,291,292,293,294,295,296,297,298,311,312,313,320,350,370,380,401,402,411,412,413",n=be+"keepright.ipax.at/export.php?format=gpx&ch="+s+"&left="+i+"&bottom="+r+"&right="+e+"&top="+a;t.open("GET",n,!0),t.send(),T>0&&p("KeepRight Query ..."),T>1&&p(n)}}}function Tt(t,i,e){var r=t.indexOf(i),a=t.indexOf(e,r+i.length);return t.substr(r+i.length,a-(r+i.length))}function Ho(t){T>3&&p("KeepRight readData start");for(var i=t;i.length>22;){var e=i.indexOf("<wpt "),r=i.indexOf("</wpt>",5);if(e<0||r<0)break;var a=i.substr(e+5,r-e-5);i=i.slice(r,i.length);var s=Tt(a,'lon="','"'),n=Tt(a,'lat="','"'),h=Tt(a,"<name><![CDATA[","]"),l=Tt(a,"<desc><![CDATA[","]"),f=Tt(a,"<schema>","<"),d=Tt(a,"<id>","<"),u=Tt(a,"<error_type>","<"),v=Tt(a,"<object_type>","<"),y=Tt(a,"<object_id>","<"),m=tt(s,n),w=it(n);if(T>3&&p("EINTRAG lon,lat:",s,n,"Name:..",h,l),!!Nn){l=l.slice(6,l.length);var M=new B(d);if(M.id>0){M.typeMain="_keep",M.AddTag("Keepright",v),M.AddTag("",h),M.AddTag("",l),M.AddTag("",""),M.AddTag("OSM ID",y),M.AddTag("K.R.  ID",d),M.AddTag("_keep",f),M.AddTag("Error",u);var x=new la(5,0,100,3),b=new V(x,o.dblau);b.position.y=100/2,b.position.x=m,b.position.z=w,b.osm=M,re.add(b)}}}T>1&&p("KeepRight readData end")}var di=new Array,Ya=document.location.search.substr(1,Math.min(document.location.search.length,500));T>0&&p("!!1!!"+Ya.replace("&","§"));if(Ya!=""){var Js=Ya.split("&");for(var Zo in Js){var $s="",Rr=Js[Zo].split("=");Rr.length>1&&($s=Rr[1]),di[unescape(Rr[0])]=unescape($s)}}function Le(t){return!di||!di[t]?"":di[t]}function $(t,i){return!di||!di[t]?i:di[t]}var hi="";function js(t){hi=t}var T=$("dbg",0)*1;function Qo(t){T=t}function Jo(){T++}var vi=0,qa=10,gi=0;function $o(t,i){vi=t,gi=i}function Xr(t){qa=t}var jo=$("wmx",1e9)*1,na=$("ser",1)*1,ve=$("cu",0)*1,Ks=$("err",20)*1,be="https://",z=!1,Gi="createTouch"in document,Ve=document.getElementById("container"),Ko=document.getElementById("loading");Ko.innerHTML="";var $r=null,ae=-1;function kn(t){kn=t}Le("card")&&(ae=Le("card")*1);uh()&&(ae=0);ae==-1&&(Gi&&Ve.offsetWidth>Ve.offsetHeight?ae=1:ae=0);var ui=window.location.protocol+"//"+window.location.host+window.location.pathname;ui=ui.slice(0,ui.lastIndexOf("/"));T>2&&p("myURL: ",ui);ui.substring(0,5)=="http:"&&(be="https://",T>0&&p("::::::::::    You are using http://    :::::::::::"));var Ze=$("lat",0)*1,Ie=$("lon",0)*1;function eh(t,i){Ze=t,Ie=i}var Pi=Ze==0&&Ie==0;function th(){Pi=!1}var yi=$("mdl",99)*1,pe=$("vil",17)*1;function Br(t){pe=t}var At=$("dil",1)*1,qt=$("avi",0)*1,Sn="-";Math.abs(Ze)<37&&(Sn="palm");var ja=1001;function fs(){ja++}var en=new qn,Ye,F,we,ds,Xe,Fi,j,pt,Wa=[],tn=[],us,Pe=$("tiles",5)*1;function ih(t){Pe=t}var Gt=136144289,Ut=!1,Ka=200;Pe==0&&(Ka=0);var Zi=Le("id");Zi&&(Zi[0]!="+"&&(Ut=!0),Gt=Zi*1);var Se=$("fly",4),oa=$("multi",0)*1,Ti="",Ua=!0;function _n(t){Ua=t}var ze=$("user","user").toLowerCase();function an(t){ze=t}(ze==""||ze=="user"||ze=="noname"||!On(ze))&&(ze="user",Ua=!1);if(oa&&!Ua){var rn="myname";Ti=prompt("Enter a name to multiplay",rn),T>0&&p("input userName: ",Ti),Ti!=null&&Ti!=rn&&On(Ti)?(ze=Ti.toLowerCase(),Ua=!0):oa=!1}T>0&&p("userName: ",ze,"multiplay: ",oa);var Qi=-2;function sn(t){Qi=t}var Ji=[],cs=new Bt({side:Qe}),nn=new Bt({side:cn}),Be=void 0,ah=new V,si=new V;function rh(t){si=t,si.visible=j.controlMode==2}var ot=new V,X=.05,Yr=$("hei",0),on=$("abs",0),An,jr=[],R=Le("sha")=="1";function sh(t){R=t}Gi==1&&(R=!1);var Fe=0;function ht(t){Fe=t}var Nt=0;Le("sim")&&(Nt=1,p("OSM-Simulation"),Ze=49.7151,Ie=11.087,Pi=!1);function nh(t){Nt=t}var Gn=0;Pe>3&&(Gn=2);var Ci=$("opt",Gn)*1;function hn(t){Ci=t}var He=$("replay",0);ve==2&&(Ci=0);na==3&&(pe=16,At=0);if(He){var nt=new XMLHttpRequest;nt.onreadystatechange=function(){if(p(nt.readyState,nt.status),nt.readyState==2&&nt.status==404&&alert("Replay file missing: "+He),nt.readyState==4&&nt.status==200){p("replay replay replay replay replay replay replay "),qt?(He=nt.response.split("$"),Hi(1)):(He=nt.response.split("<br>"),Hi(0));var t=He[Oe];if(qt){var i=t.split(",");Ze=Xa(i[3]*1),i[4]=="S"&&(Ze*=-1),Ie=Xa(i[5]*1),i[6]=="W"&&(Ie*=-1),F&&(F.position.y=55)}else{var i=t.split(";");Ze=i[2]*1,Ie=i[3]*1,F&&(F.position.y=i[4])}Pi=!1,Fe=0,z&&z.Out(["Replay found"])}},nt.open("GET","user/"+He+".log",!0),nt.send(),Fe=22,Pi=!1}Le("gps");Ie<-180&&(Ie+=360);Ie>180&&(Ie-=360);var Nn=Le("keep")=="1",ha=-9e9,zi=9e9,er=9e9,tr=-9e9;function oh(t,i,e,r){ha=t,zi=i,er=e,tr=r}var pa=new vn,Ni,Xt,o=null,zt=$("zoom",1)*40,hh=6,lh=1e5,fh=15e4,dh=.05,Kr=1e4;function ir(t,i,e){var r=t;if(e&&(r=r+","+e),T>2&&p(r),hi+="!"+r,!!i&&Number.isInteger(i.id)&&!(Ks<=0)){Ks--,i.terr=r,i.AddTag("Tag Error:",r);var a=Math.floor(i.wayNodes.length/2),s=H[i.wayNodes[a]];if(!(!s||qt)){var n=new la(5,0,300,3),h=new V(n,o.red);h.position.y=300/2,h.position.x=s.x,h.position.z=s.z,h.osm=i,re.add(h)}}}function at(t,i,e,r,a,s){T>2&&p(t,i,e,r,a,s)}function p(t,i,e,r,a,s){var n=t;i&&(n=n+","+i),e&&(n=n+","+e),r&&(n=n+","+r),a&&(n=n+","+a),s&&(n=n+","+s),console.log(n),hi+="!"+n}function k(t){return t/180*Math.PI}function kt(t){return t*180/Math.PI}function On(t){if(t.length<2)return!1;for(var i=0;i<t.length;i++){var e=t.charAt(i),r=e.charCodeAt(0);if(!(r>47&&r<58||r>64&&r<91||r>96&&r<123))return!1}return!0}function uh(){return navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)}function ch(){var t=(er-ha)*(Pe+1),i=(zi-tr)*(Pe+2);t=Math.floor(t*100)/100,i=Math.floor(i*100)/100;var e=[];e.push(new ee(1e4,1e4)),e.push(new ee(1e4,-1e4)),e.push(new ee(-1e4,-1e4)),e.push(new ee(-1e4,1e4)),e.push(new ee(1e4,1e4));var r=new Ke(e);e=[],e.push(new ee(+i,+t)),e.push(new ee(-t,+t)),e.push(new ee(-t,-i)),e.push(new ee(+i,-i)),e.push(new ee(+i,+t)),r.holes.push(new Ke(e));var a=new Ha(r),s=new ut({color:o.white,side:Qe});Xt=new V(a,s),Xt.rotation.x=k(90),Xt.position.y=X*6,Xt.name="LowDome",Ye.add(Xt);var n=new fa;n.load("models/sky_dome4.jpg",function(h){nn.map=h;var l=Pe;l<4&&(l=4);var f=l*t/(Pe+1);Ni=new V(new Za(f,32*2,16*2,0,k(360),k(0),k(180)),nn),Ni.scale.y=.7,Ni.name="SkyDome",Ye.add(Ni)},function(h){T>2&&p(h.loaded/h.total*100+"% loaded  SKY TextureLoader")})}function ph(){var t=window.innerWidth,i=window.innerHeight,e=512;Xe=new Un({antialias:!0}),Xe.setSize(window.innerWidth,window.innerHeight),Xe.setSize(t,i),Xe.setClearColor(7555592),Xe.setPixelRatio(window.devicePixelRatio),Xe.autoClear=!1,Ve.appendChild(Xe.domElement),Ye=new Gs,F=new es(zt,t/i,dh,Kr);var r=new Ns(16777215,.7);Ye.add(r),pt=new Vn(16777215,1),pt.position.set(hh,fh,lh),R&&(p("SHADOW on"),Xe.shadowMap.enabled=!0,Xe.shadowMap.type=Hn,pt.castShadow=!0,pt.shadow.mapSize.width=e,pt.shadow.mapSize.height=e,pt.shadow.camera.near=.5,pt.shadow.camera.far=500),Ye.add(pt),T>2&&p("Platform:"+navigator.platform+"tttd w:"+t+" h:"+i);var a=0;if(ae)ds=new Zn(Xe,a);else{we=new Qn(0,0,0,0,0,500),Fi=new Gs;var r=new Ns(4473924);Fi.add(r)}j=new Bo(Xe,F),He&&(j.controlMode=1),ae||(z=new Go(Ye,Fi)),o=new $a,An=new Vo,$r=new ca;var s=function(f){if(f.lengthComputable){var d=f.loaded/f.total*100;T>2&&p(Math.round(d,2)+"% downloaded")}};T>0&&p("::: FLY: "+Se);var n;Se=="1"&&(n="Orion3"),Se=="2"&&(n="Lancet_TNG"),Se=="3"&&(n="Frog_TNG"),Se=="4"&&(n="Cessna"),Se=="5"&&(n="t65xwing"),Se=="6"&&(n="TIE_Fighter"),Se=="7"&&(n="Quadrotor"),Se=="8"&&(n="delorean");var h=new pn;!Nt&&yi>0&&h.load("models/"+n+".dae",function(f){var d=f.scene.children;for(var u in d){var v=d[u];v.name="x"+u,v.receiveShadow=R,v.castShadow=R;for(var m in v.children){var y=v.children[m];y.receiveShadow=R,y.castShadow=R}ot.add(v)}var m=.01,w=-90,M=4;Se=="1"&&(m=.05),Se=="4"&&(m=.02,w=180,M=-1),Se=="5"&&(m=.02,w=90,M=3),Se=="6"&&(m=.02,w=90,M=3),Se=="7"&&(m=.2,w=0,M=-2),Se=="8"&&(m=1/32,w=180,M=-.7),ot.scale.set(m,m,m),ot.rotation.x=k(-90),ot.rotation.z=k(w),ot.position.x=M,ot.name="mesh3FlyCol",ot.receiveShadow=R,ot.castShadow=R,ot.visible=j.controlMode==3,Be.add(ot)},s),Be=new V,Be.position.copy(F.position),Be.rotation.copy(F.rotation),Be.receiveShadow=R,Be.castShadow=R,Be.name="meshXQuaFly",re.add(Be),j.Flight.init(Be);var l=new fa;Nt||l.load("eye_smiley.png",function(f){cs.map=f},function(f){T>2&&p(f.loaded/f.total*100+"% loaded  EYE TextureLoader")}),Lo(),T==1.3&&Di(4799,"server","burg",0,0,"obj"),T==1.2&&Di(4799,"server","car",0,0,"obj"),vh("models/windmile.glb"),ps()}function vh(t){new ln().load(t,function(e){us=e},void 0,function(e){console.error("Error loading GLB:",e)})}function gh(t){var i=us;const e=Jn(i.scene);if(i.animations&&i.animations.length>0){var r=new $n(e);i.animations.forEach(n=>{r.clipAction(n).play()}),Wa.push(r)}e.traverse(function(n){n.isMesh&&(n.castShadow=!0,n.receiveShadow=!0)});const a=new jn().setFromObject(e),s=new Ei(t.x,-a.min.y,t.y);e.position.add(s),Ye.add(e)}ph();function ps(){var t=pa.getDelta()+1e-6;if(t>Yt){var i="dt: "+Math.floor(t*1e3)+"ms";t>1&&(i+=" ------------------"),console.log(i),t=Yt,j.Stop()}if(us&&(tn.length>0&&gh(tn.pop()),Wa.length>0))for(var e in Wa){var r=Wa[e];r.update(t)}j.update(t),$r&&$r.update(t),F.updateProjectionMatrix();for(var a in jr)jr[a].rotation.z+=t;Xe.clear(),ae?ds.render(Ye,F):(Xe.render(Ye,F),Xe.render(Fi,we)),requestAnimationFrame(ps)}
